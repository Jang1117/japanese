<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÌûàÎùºÍ∞ÄÎÇò Îî∞ÎùºÏì∞Í∏∞</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&family=Noto+Sans+JP:wght@400;700&family=Zen+Maru+Gothic:wght@400;700&family=Kosugi+Maru&family=M+PLUS+Rounded+1c:wght@400;700&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --jp-font: 'Noto Sans JP', sans-serif; }
        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .jp-text { font-family: var(--jp-font); }
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 30px;
            max-width: 500px;
            width: 100%;
        }
        h1 { color: #667eea; font-size: 20px; min-width: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; flex: 1; }
        .header { display: flex; align-items: center; margin-bottom: 20px; gap: 8px; }
        .back-button, .font-button {
            background: #e9ecef; border: none; border-radius: 8px;
            width: 36px; height: 36px; cursor: pointer; font-size: 16px;
            transition: all 0.3s; flex-shrink: 0;
            display: flex; align-items: center; justify-content: center;
        }
        .back-button:hover { background: #dee2e6; transform: translateX(-3px); }
        .font-button:hover { background: #dee2e6; }
        .header-buttons { display: flex; gap: 6px; flex-shrink: 0; }
        .chart-button, .quiz-button {
            background: linear-gradient(135deg, #ff6b9d 0%, #c44569 100%);
            border: none; border-radius: 8px; width: 36px; height: 36px;
            cursor: pointer; font-size: 16px; transition: all 0.3s;
            flex-shrink: 0; display: flex; align-items: center; justify-content: center; color: white;
        }
        .quiz-button { background: linear-gradient(135deg, #20c997 0%, #12b886 100%); }
        .chart-button:hover, .quiz-button:hover { transform: scale(1.1); box-shadow: 0 4px 15px rgba(196, 69, 105, 0.4); }
        .quiz-button:hover { box-shadow: 0 4px 15px rgba(32, 201, 151, 0.4); }
        .character-display { text-align: center; margin-bottom: 20px; }
        .current-character {
            font-size: 80px; color: #764ba2; font-weight: bold;
            margin-bottom: 10px; position: relative; display: inline-block;
        }
        .check-mark {
            position: absolute; top: -5px; right: -25px;
            font-size: 24px; color: #51cf66; display: none;
        }
        .check-mark.show { display: block; animation: popIn 0.3s ease; }
        @keyframes popIn { 0% { transform: scale(0); } 50% { transform: scale(1.3); } 100% { transform: scale(1); } }
        .character-info { font-size: 18px; color: #666; }
        .canvas-container {
            position: relative; background: #f8f9fa; border-radius: 15px;
            margin-bottom: 20px; border: 3px solid #e0e0e0; overflow: hidden;
        }
        #drawingCanvas { display: block; width: 100%; height: 250px; cursor: crosshair; touch-action: none; }
        .guide-canvas { position: absolute; top: 0; left: 0; pointer-events: none; opacity: 0.3; }
        .controls { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 10px; }
        .controls-three { grid-template-columns: repeat(3, 1fr); }
        .controls-three button { padding: 12px 8px; font-size: 13px; }
        button {
            padding: 14px 10px; border: none; border-radius: 10px;
            font-size: 15px; font-weight: bold; cursor: pointer;
            transition: all 0.3s; white-space: nowrap;
        }
        .btn-clear { background: #ff6b6b; color: white; }
        .btn-clear:hover { background: #ff5252; transform: translateY(-2px); }
        .btn-next { background: #51cf66; color: white; }
        .btn-next:hover { background: #40c057; transform: translateY(-2px); }
        .btn-prev { background: #74c0fc; color: white; }
        .btn-prev:hover { background: #4dabf7; transform: translateY(-2px); }
        .btn-show-guide { background: #ffd43b; color: #333; }
        .btn-show-guide:hover { background: #fcc419; transform: translateY(-2px); }
        .btn-check { background: #845ef7; color: white; }
        .btn-check:hover { background: #7950f2; transform: translateY(-2px); }
        .btn-check.checked { background: #51cf66; }
        .progress { text-align: center; color: #666; font-size: 14px; margin-bottom: 10px; }
        .level-selector { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px; }
        .level-btn {
            padding: 12px 10px; background: #e9ecef; color: #495057;
            border: 2px solid transparent; border-radius: 10px;
            font-size: 14px; font-weight: bold; cursor: pointer;
            transition: all 0.3s; white-space: nowrap;
        }
        .level-btn.active { background: #667eea; color: white; border-color: #667eea; }
        .level-btn:hover { transform: translateY(-2px); }
        .category-selector { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin-bottom: 20px; }
        .category-btn {
            padding: 10px 5px; background: #e9ecef; color: #495057;
            border: 2px solid transparent; font-size: 16px;
            border-radius: 8px; cursor: pointer; transition: all 0.3s; position: relative;
        }
        .category-btn.active { background: #667eea; color: white; border-color: #667eea; }
        .category-btn .cat-progress {
            position: absolute; bottom: 2px; left: 50%; transform: translateX(-50%);
            font-size: 8px; color: #51cf66;
        }
        .stroke-order {
            text-align: center; margin-top: 10px; padding: 12px;
            background: #e7f5ff; border-radius: 8px; font-size: 14px;
            color: #1864ab; min-height: 60px;
            display: flex; align-items: center; justify-content: center; line-height: 1.5;
        }
        .shortcut-hint { text-align: center; margin-top: 10px; font-size: 12px; color: #adb5bd; }
        .shortcut-hint kbd { background: #e9ecef; padding: 2px 6px; border-radius: 4px; font-family: monospace; margin: 0 2px; }
        .font-dropdown { position: relative; display: inline-block; }
        .font-dropdown-content {
            display: none; position: absolute; top: 100%; right: 0;
            background: white; min-width: 160px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2); border-radius: 8px; z-index: 100; overflow: hidden;
        }
        .font-dropdown-content.show { display: block; }
        .font-option { padding: 10px 15px; cursor: pointer; transition: background 0.2s; font-size: 14px; }
        .font-option:hover { background: #f0f0f0; }
        .font-option.active { background: #667eea; color: white; }
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(5px);
            z-index: 1000; justify-content: center; align-items: center;
            padding: 20px; animation: fadeIn 0.3s ease;
        }
        .modal-overlay.show { display: flex; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px) scale(0.95); } to { opacity: 1; transform: translateY(0) scale(1); } }
        .modal-content {
            background: white; border-radius: 20px; max-width: 95vw; max-height: 90vh;
            overflow: auto; position: relative; animation: slideUp 0.3s ease;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.4);
        }
        .modal-header {
            position: sticky; top: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 20px 25px;
            display: flex; justify-content: space-between; align-items: center;
            border-radius: 20px 20px 0 0; z-index: 10;
        }
        .modal-header h2 { font-size: 20px; display: flex; align-items: center; gap: 10px; }
        .modal-close {
            background: rgba(255, 255, 255, 0.2); border: none; color: white;
            width: 36px; height: 36px; border-radius: 50%; font-size: 20px;
            cursor: pointer; transition: all 0.3s;
            display: flex; align-items: center; justify-content: center;
        }
        .modal-close:hover { background: rgba(255, 255, 255, 0.3); transform: rotate(90deg); }
        .modal-body { padding: 25px; }
        .hiragana-table { width: 100%; border-collapse: collapse; font-size: 14px; }
        .hiragana-table th {
            background: linear-gradient(135deg, #ffeef8 0%, #f8e1eb 100%);
            padding: 10px 6px; font-weight: bold; color: #764ba2;
            border: 1px solid #e0c4d4; font-size: 13px;
        }
        .hiragana-table td {
            padding: 8px 4px; text-align: center; border: 1px solid #e9ecef;
            vertical-align: middle; transition: all 0.2s;
        }
        .hiragana-table td:hover { background: #f0e6ff; transform: scale(1.05); }
        .hiragana-table .row-header {
            background: linear-gradient(135deg, #ffeef8 0%, #f8e1eb 100%);
            font-weight: bold; color: #764ba2; font-size: 13px;
        }
        .char-cell { display: flex; flex-direction: column; align-items: center; gap: 2px; }
        .char-main { font-size: 24px; color: #333; font-weight: 500; }
        .char-romaji { font-size: 10px; color: #888; }
        .empty-cell { background: #f8f9fa; color: #ccc; }
        .table-tabs { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .table-tab {
            padding: 10px 20px; background: #e9ecef; border: none; border-radius: 25px;
            font-size: 14px; font-weight: bold; cursor: pointer; transition: all 0.3s; color: #495057;
        }
        .table-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        .table-tab:hover { transform: translateY(-2px); }
        .table-section { display: none; }
        .table-section.active { display: block; }
        .section-title {
            font-size: 16px; color: #667eea; margin-bottom: 15px;
            padding-bottom: 10px; border-bottom: 2px solid #e9ecef;
            display: flex; align-items: center; gap: 8px;
        }
        .yoon-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .yoon-table th, .yoon-table td { padding: 8px 6px; text-align: center; border: 1px solid #e9ecef; }
        .yoon-table th { background: linear-gradient(135deg, #e7f5ff 0%, #d0ebff 100%); color: #1864ab; font-size: 12px; }
        .table-scroll { overflow-x: auto; margin-bottom: 15px; }
        .combined-table { min-width: 900px; }
        .combined-table th, .combined-table td { min-width: 55px; padding: 6px 4px; }
        .dakuon-header { background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%) !important; color: #e65100 !important; }
        .handakuon-header { background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%) !important; color: #2e7d32 !important; }
        .dakuon-cell { background: #fff8e1; }
        .handakuon-cell { background: #e8f5e9; }
        .dakuon-row td { background: #fff8e1; }
        .handakuon-row td { background: #e8f5e9; }
        .legend {
            display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;
            margin-top: 15px; padding: 12px; background: #f8f9fa; border-radius: 10px;
        }
        .legend-item { display: flex; align-items: center; gap: 6px; font-size: 13px; color: #495057; }
        .legend-box { width: 16px; height: 16px; border-radius: 4px; border: 1px solid #dee2e6; }
        .seion-box { background: white; }
        .dakuon-box { background: #fff8e1; }
        .handakuon-box { background: #e8f5e9; }
        .quiz-modal .modal-header { background: linear-gradient(135deg, #20c997 0%, #12b886 100%); }
        .quiz-container { text-align: center; }
        .quiz-type-selector { display: flex; gap: 8px; justify-content: center; margin-bottom: 15px; }
        .quiz-type-btn {
            padding: 8px 16px; background: #e9ecef; border: none; border-radius: 20px;
            cursor: pointer; font-size: 13px; font-weight: bold; transition: all 0.3s;
        }
        .quiz-type-btn.active { background: #20c997; color: white; }
        .quiz-question { font-size: 36px; color: #333; margin: 20px 0 5px; font-weight: bold; }
        .quiz-hint { font-size: 18px; color: #868e96; margin-bottom: 15px; }
        .quiz-canvas-container {
            position: relative; background: #f8f9fa; border-radius: 15px;
            margin: 15px auto; border: 3px solid #e0e0e0; overflow: hidden; max-width: 350px;
        }
        #quizCanvas { display: block; width: 100%; height: 180px; cursor: crosshair; touch-action: none; }
        .quiz-guide-canvas { position: absolute; top: 0; left: 0; pointer-events: none; opacity: 0; transition: opacity 0.3s; }
        .quiz-guide-canvas.show { opacity: 0.3; }
        .quiz-controls-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 15px; }
        .quiz-controls-row button { padding: 12px 8px; font-size: 18px; }
        .btn-show-answer { background: #868e96; color: white; }
        .btn-show-answer:hover { background: #495057; }
        .btn-correct { background: #51cf66; color: white; }
        .btn-correct:hover { background: #40c057; }
        .btn-wrong { background: #ff6b6b; color: white; }
        .btn-wrong:hover { background: #fa5252; }
        .quiz-score { display: flex; justify-content: center; gap: 30px; margin-bottom: 15px; font-size: 16px; }
        .quiz-score .correct { color: #51cf66; }
        .quiz-score .wrong { color: #ff6b6b; }
        @media (max-width: 500px) {
            .modal-body { padding: 15px; }
            .char-main { font-size: 20px; }
            .char-romaji { font-size: 9px; }
            .hiragana-table th, .hiragana-table td { padding: 6px 3px; }
            .table-tab { padding: 8px 14px; font-size: 12px; }
            .quiz-question { font-size: 28px; }
        }
        @media (max-width: 400px) {
            .container { padding: 20px 15px; }
            h1 { font-size: 16px; }
            .header { gap: 6px; }
            .header-buttons { gap: 4px; }
            .back-button, .font-button, .chart-button, .quiz-button {
                width: 32px; height: 32px; font-size: 14px;
            }
            .current-character { font-size: 60px; }
            .character-info { font-size: 16px; }
            .category-selector { grid-template-columns: repeat(5, 1fr); gap: 6px; }
            .category-btn { padding: 8px 3px; font-size: 14px; }
            button { padding: 12px 8px; font-size: 14px; }
            .stroke-order { font-size: 13px; padding: 10px; }
            .shortcut-hint { display: none; }
        }
        @media (max-width: 340px) {
            h1 { font-size: 14px; }
            .back-button, .font-button, .chart-button, .quiz-button {
                width: 28px; height: 28px; font-size: 12px; border-radius: 6px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="back-button" onclick="goBack()">‚Üê</button>
            <h1>„ÅÇ ÌûàÎùºÍ∞ÄÎÇò</h1>
            <div class="header-buttons">
                <button class="quiz-button" onclick="openQuiz()" title="ÌÄ¥Ï¶à Î™®Îìú">Q</button>
                <button class="chart-button" onclick="openChart()" title="ÌûàÎùºÍ∞ÄÎÇò Ìëú Î≥¥Í∏∞">Ë°®</button>
                <div class="font-dropdown">
                    <button class="font-button" onclick="toggleFontDropdown()" title="Ìè∞Ìä∏ Î≥ÄÍ≤Ω">Aa</button>
                    <div class="font-dropdown-content" id="fontDropdown">
                        <div class="font-option active" onclick="setFont('Noto Sans JP')" style="font-family: 'Noto Sans JP'">Noto Sans JP</div>
                        <div class="font-option" onclick="setFont('Zen Maru Gothic')" style="font-family: 'Zen Maru Gothic'">Zen Maru Gothic</div>
                        <div class="font-option" onclick="setFont('Kosugi Maru')" style="font-family: 'Kosugi Maru'">Kosugi Maru</div>
                        <div class="font-option" onclick="setFont('M PLUS Rounded 1c')" style="font-family: 'M PLUS Rounded 1c'">M PLUS Rounded</div>
                    </div>
                </div>

            </div>
        </div>
        <div class="level-selector">
            <button class="level-btn active" onclick="selectTab('basic')">Ï≤≠Ïùå¬∑ÌÉÅÏùå¬∑Î∞òÌÉÅÏùå</button>
            <button class="level-btn" onclick="selectTab('extended')">ÏöîÏùå (ÊãóÈü≥)</button>
        </div>
        <div class="category-selector" id="categorySelector"></div>
        <div class="progress" id="progressText">1 / 5</div>
        <div class="character-display">
            <div class="current-character jp-text" id="currentCharacter">„ÅÇ<span class="check-mark" id="checkMark">‚úì</span></div>
            <div class="character-info" id="characterInfo">a (ÏïÑ)</div>
        </div>
        <div class="canvas-container">
            <canvas id="drawingCanvas"></canvas>
            <canvas id="guideCanvas" class="guide-canvas"></canvas>
        </div>
        <div class="controls">
            <button class="btn-prev" onclick="prevCharacter()">‚óÄ Ïù¥Ï†Ñ</button>
            <button class="btn-next" onclick="nextCharacter()">Îã§Ïùå ‚ñ∂</button>
        </div>
        <div class="controls controls-three">
            <button class="btn-clear" onclick="clearCanvas()">üóë ÏßÄÏö∞Í∏∞</button>
            <button class="btn-show-guide" onclick="toggleGuide()">üëÅ Í∞ÄÏù¥Îìú</button>
            <button class="btn-check" id="checkBtn" onclick="toggleCheck()">‚úì ÏôÑÎ£å</button>
        </div>
        <div class="stroke-order" id="strokeOrder">ÌöçÏàú: 3Ìöç</div>
        <div class="shortcut-hint">Îã®Ï∂ïÌÇ§: <kbd>‚Üê</kbd> Ïù¥Ï†Ñ <kbd>‚Üí</kbd> Îã§Ïùå <kbd>Space</kbd> ÏßÄÏö∞Í∏∞ <kbd>Enter</kbd> ÏôÑÎ£å</div>
    </div>

    <!-- ÌûàÎùºÍ∞ÄÎÇò Ìëú Î™®Îã¨ -->
    <div class="modal-overlay" id="chartModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìã ÌûàÎùºÍ∞ÄÎÇò Ìëú</h2>
                <button class="modal-close" onclick="closeChart()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="table-tabs">
                    <button class="table-tab active" onclick="switchTableTab('seion')">Ï≤≠Ïùå ¬∑ ÌÉÅÏùå ¬∑ Î∞òÌÉÅÏùå</button>
                    <button class="table-tab" onclick="switchTableTab('yoon')">ÏöîÏùå (ÊãóÈü≥)</button>
                </div>
                <div class="table-section active" id="seion-section">
                    <div class="section-title">‚ú® Ï≤≠Ïùå ¬∑ ÌÉÅÏùå ¬∑ Î∞òÌÉÅÏùå</div>
                    <div class="table-scroll">
                        <table class="hiragana-table combined-table">
                            <thead><tr>
                                <th></th><th>„ÅÇ</th><th>„Åã</th><th class="dakuon-header">„Åå</th>
                                <th>„Åï</th><th class="dakuon-header">„Åñ</th><th>„Åü</th><th class="dakuon-header">„Å†</th>
                                <th>„Å™</th><th>„ÅØ</th><th class="dakuon-header">„Å∞</th><th class="handakuon-header">„Å±</th>
                                <th>„Åæ</th><th>„ÇÑ</th><th>„Çâ</th><th>„Çè</th>
                            </tr></thead>
                            <tbody>
                                <tr><td class="row-header">„ÅÇÎã®</td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„ÅÇ</span><span class="char-romaji">a/ÏïÑ</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„Åã</span><span class="char-romaji">ka/Ïπ¥</span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">„Åå</span><span class="char-romaji">ga/Í∞Ä</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„Åï</span><span class="char-romaji">sa/ÏÇ¨</span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">„Åñ</span><span class="char-romaji">za/Ïûê</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„Åü</span><span class="char-romaji">ta/ÌÉÄ</span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">„Å†</span><span class="char-romaji">da/Îã§</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„Å™</span><span class="char-romaji">na/ÎÇò</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„ÅØ</span><span class="char-romaji">ha/Ìïò</span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">„Å∞</span><span class="char-romaji">ba/Î∞î</span></div></td>
                                    <td class="handakuon-cell"><div class="char-cell"><span class="char-main jp-text">„Å±</span><span class="char-romaji">pa/Ìåå</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„Åæ</span><span class="char-romaji">ma/Îßà</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„ÇÑ</span><span class="char-romaji">ya/Ïïº</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„Çâ</span><span class="char-romaji">ra/Îùº</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„Çè</span><span class="char-romaji">wa/ÏôÄ</span></div></td>
                                </tr>
                                <tr><td class="row-header">„ÅÑÎã®</td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„ÅÑ</span><span class="char-romaji">i/Ïù¥</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„Åç</span><span class="char-romaji">ki/ÌÇ§</span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">„Åé</span><span class="char-romaji">gi/Í∏∞</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„Åó</span><span class="char-romaji">shi/Ïãú</span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">„Åò</span><span class="char-romaji">ji/ÏßÄ</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„Å°</span><span class="char-romaji">chi/Ïπò</span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">„Å¢</span><span class="char-romaji">ji/ÏßÄ</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„Å´</span><span class="char-romaji">ni/Îãà</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„Å≤</span><span class="char-romaji">hi/Ìûà</span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">„Å≥</span><span class="char-romaji">bi/ÎπÑ</span></div></td>
                                    <td class="handakuon-cell"><div class="char-cell"><span class="char-main jp-text">„Å¥</span><span class="char-romaji">pi/Ìîº</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„Åø</span><span class="char-romaji">mi/ÎØ∏</span></div></td>
                                    <td class="empty-cell">-</td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„Çä</span><span class="char-romaji">ri/Î¶¨</span></div></td>
                                    <td class="empty-cell">-</td>
                                </tr>
                                <tr><td class="row-header">„ÅÜÎã®</td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„ÅÜ</span><span class="char-romaji">u/Ïö∞</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„Åè</span><span class="char-romaji">ku/Ïø†</span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">„Åê</span><span class="char-romaji">gu/Íµ¨</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„Åô</span><span class="char-romaji">su/Ïä§</span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">„Åö</span><span class="char-romaji">zu/Ï¶à</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„Å§</span><span class="char-romaji">tsu/Ï∏†</span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">„Å•</span><span class="char-romaji">zu/Ï¶à</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„Å¨</span><span class="char-romaji">nu/ÎàÑ</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„Åµ</span><span class="char-romaji">fu/ÌõÑ</span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">„Å∂</span><span class="char-romaji">bu/Î∂Ä</span></div></td>
                                    <td class="handakuon-cell"><div class="char-cell"><span class="char-main jp-text">„Å∑</span><span class="char-romaji">pu/Ìë∏</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„ÇÄ</span><span class="char-romaji">mu/Î¨¥</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„ÇÜ</span><span class="char-romaji">yu/Ïú†</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„Çã</span><span class="char-romaji">ru/Î£®</span></div></td>
                                    <td class="empty-cell">-</td>
                                </tr>
                                <tr><td class="row-header">„ÅàÎã®</td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„Åà</span><span class="char-romaji">e/Ïóê</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„Åë</span><span class="char-romaji">ke/ÏºÄ</span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">„Åí</span><span class="char-romaji">ge/Í≤å</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„Åõ</span><span class="char-romaji">se/ÏÑ∏</span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">„Åú</span><span class="char-romaji">ze/Ï†ú</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„Å¶</span><span class="char-romaji">te/ÌÖå</span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">„Åß</span><span class="char-romaji">de/Îç∞</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„Å≠</span><span class="char-romaji">ne/ÎÑ§</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„Å∏</span><span class="char-romaji">he/Ìó§</span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">„Åπ</span><span class="char-romaji">be/Î≤†</span></div></td>
                                    <td class="handakuon-cell"><div class="char-cell"><span class="char-main jp-text">„Å∫</span><span class="char-romaji">pe/Ìéò</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„ÇÅ</span><span class="char-romaji">me/Î©î</span></div></td>
                                    <td class="empty-cell">-</td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„Çå</span><span class="char-romaji">re/Î†à</span></div></td>
                                    <td class="empty-cell">-</td>
                                </tr>
                                <tr><td class="row-header">„ÅäÎã®</td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„Åä</span><span class="char-romaji">o/Ïò§</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„Åì</span><span class="char-romaji">ko/ÏΩî</span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">„Åî</span><span class="char-romaji">go/Í≥†</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„Åù</span><span class="char-romaji">so/ÏÜå</span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">„Åû</span><span class="char-romaji">zo/Ï°∞</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„Å®</span><span class="char-romaji">to/ÌÜ†</span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">„Å©</span><span class="char-romaji">do/ÎèÑ</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„ÅÆ</span><span class="char-romaji">no/ÎÖ∏</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„Åª</span><span class="char-romaji">ho/Ìò∏</span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">„Åº</span><span class="char-romaji">bo/Î≥¥</span></div></td>
                                    <td class="handakuon-cell"><div class="char-cell"><span class="char-main jp-text">„ÅΩ</span><span class="char-romaji">po/Ìè¨</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„ÇÇ</span><span class="char-romaji">mo/Î™®</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„Çà</span><span class="char-romaji">yo/Ïöî</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„Çç</span><span class="char-romaji">ro/Î°ú</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">„Çí</span><span class="char-romaji">wo/Ïò§</span></div></td>
                                </tr>
                                <tr><td class="row-header">„Çì</td><td colspan="15"><div class="char-cell"><span class="char-main jp-text">„Çì</span><span class="char-romaji">n/Ïùë</span></div></td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="legend">
                        <span class="legend-item"><span class="legend-box seion-box"></span> Ï≤≠Ïùå</span>
                        <span class="legend-item"><span class="legend-box dakuon-box"></span> ÌÉÅÏùå</span>
                        <span class="legend-item"><span class="legend-box handakuon-box"></span> Î∞òÌÉÅÏùå</span>
                    </div>
                </div>
                <div class="table-section" id="yoon-section">
                    <div class="section-title">üéµ ÏöîÏùå</div>
                    <table class="yoon-table">
                        <thead><tr><th></th><th>~„ÇÉ</th><th>~„ÇÖ</th><th>~„Çá</th></tr></thead>
                        <tbody>
                            <tr><td class="row-header">„Åç</td><td><div class="char-cell"><span class="char-main jp-text">„Åç„ÇÉ</span><span class="char-romaji">kya/Ï∫¨</span></div></td><td><div class="char-cell"><span class="char-main jp-text">„Åç„ÇÖ</span><span class="char-romaji">kyu/ÌÅê</span></div></td><td><div class="char-cell"><span class="char-main jp-text">„Åç„Çá</span><span class="char-romaji">kyo/ÏøÑ</span></div></td></tr>
                            <tr class="dakuon-row"><td class="row-header">„Åé</td><td><div class="char-cell"><span class="char-main jp-text">„Åé„ÇÉ</span><span class="char-romaji">gya/Í∞∏</span></div></td><td><div class="char-cell"><span class="char-main jp-text">„Åé„ÇÖ</span><span class="char-romaji">gyu/Í∑ú</span></div></td><td><div class="char-cell"><span class="char-main jp-text">„Åé„Çá</span><span class="char-romaji">gyo/Íµê</span></div></td></tr>
                            <tr><td class="row-header">„Åó</td><td><div class="char-cell"><span class="char-main jp-text">„Åó„ÇÉ</span><span class="char-romaji">sha/ÏÉ§</span></div></td><td><div class="char-cell"><span class="char-main jp-text">„Åó„ÇÖ</span><span class="char-romaji">shu/Ïäà</span></div></td><td><div class="char-cell"><span class="char-main jp-text">„Åó„Çá</span><span class="char-romaji">sho/Ïáº</span></div></td></tr>
                            <tr class="dakuon-row"><td class="row-header">„Åò</td><td><div class="char-cell"><span class="char-main jp-text">„Åò„ÇÉ</span><span class="char-romaji">ja/Ïüà</span></div></td><td><div class="char-cell"><span class="char-main jp-text">„Åò„ÇÖ</span><span class="char-romaji">ju/Ï•¨</span></div></td><td><div class="char-cell"><span class="char-main jp-text">„Åò„Çá</span><span class="char-romaji">jo/Ï£†</span></div></td></tr>
                            <tr><td class="row-header">„Å°</td><td><div class="char-cell"><span class="char-main jp-text">„Å°„ÇÉ</span><span class="char-romaji">cha/Ï±†</span></div></td><td><div class="char-cell"><span class="char-main jp-text">„Å°„ÇÖ</span><span class="char-romaji">chu/Ï∏Ñ</span></div></td><td><div class="char-cell"><span class="char-main jp-text">„Å°„Çá</span><span class="char-romaji">cho/Ïµ∏</span></div></td></tr>
                            <tr><td class="row-header">„Å´</td><td><div class="char-cell"><span class="char-main jp-text">„Å´„ÇÉ</span><span class="char-romaji">nya/ÎÉê</span></div></td><td><div class="char-cell"><span class="char-main jp-text">„Å´„ÇÖ</span><span class="char-romaji">nyu/Îâ¥</span></div></td><td><div class="char-cell"><span class="char-main jp-text">„Å´„Çá</span><span class="char-romaji">nyo/Îá®</span></div></td></tr>
                            <tr><td class="row-header">„Å≤</td><td><div class="char-cell"><span class="char-main jp-text">„Å≤„ÇÉ</span><span class="char-romaji">hya/Ìñê</span></div></td><td><div class="char-cell"><span class="char-main jp-text">„Å≤„ÇÖ</span><span class="char-romaji">hyu/Ìú¥</span></div></td><td><div class="char-cell"><span class="char-main jp-text">„Å≤„Çá</span><span class="char-romaji">hyo/Ìö®</span></div></td></tr>
                            <tr class="dakuon-row"><td class="row-header">„Å≥</td><td><div class="char-cell"><span class="char-main jp-text">„Å≥„ÇÉ</span><span class="char-romaji">bya/Î±å</span></div></td><td><div class="char-cell"><span class="char-main jp-text">„Å≥„ÇÖ</span><span class="char-romaji">byu/Î∑∞</span></div></td><td><div class="char-cell"><span class="char-main jp-text">„Å≥„Çá</span><span class="char-romaji">byo/Îµ§</span></div></td></tr>
                            <tr class="handakuon-row"><td class="row-header">„Å¥</td><td><div class="char-cell"><span class="char-main jp-text">„Å¥„ÇÉ</span><span class="char-romaji">pya/ÌçÑ</span></div></td><td><div class="char-cell"><span class="char-main jp-text">„Å¥„ÇÖ</span><span class="char-romaji">pyu/Ìì®</span></div></td><td><div class="char-cell"><span class="char-main jp-text">„Å¥„Çá</span><span class="char-romaji">pyo/Ìëú</span></div></td></tr>
                            <tr><td class="row-header">„Åø</td><td><div class="char-cell"><span class="char-main jp-text">„Åø„ÇÉ</span><span class="char-romaji">mya/Î®Ä</span></div></td><td><div class="char-cell"><span class="char-main jp-text">„Åø„ÇÖ</span><span class="char-romaji">myu/ÎÆ§</span></div></td><td><div class="char-cell"><span class="char-main jp-text">„Åø„Çá</span><span class="char-romaji">myo/Î¨ò</span></div></td></tr>
                            <tr><td class="row-header">„Çä</td><td><div class="char-cell"><span class="char-main jp-text">„Çä„ÇÉ</span><span class="char-romaji">rya/Îû¥</span></div></td><td><div class="char-cell"><span class="char-main jp-text">„Çä„ÇÖ</span><span class="char-romaji">ryu/Î•ò</span></div></td><td><div class="char-cell"><span class="char-main jp-text">„Çä„Çá</span><span class="char-romaji">ryo/Î£å</span></div></td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- ÌÄ¥Ï¶à Î™®Îã¨ -->
    <div class="modal-overlay quiz-modal" id="quizModal">
        <div class="modal-content" style="max-width: 450px;">
            <div class="modal-header">
                <h2>üéØ ÌûàÎùºÍ∞ÄÎÇò ÌÄ¥Ï¶à</h2>
                <button class="modal-close" onclick="closeQuiz()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="quiz-container">
                    <div class="quiz-type-selector">
                        <button class="quiz-type-btn active" onclick="setQuizType('char')">Í∏ÄÏûê ÌÄ¥Ï¶à</button>
                        <button class="quiz-type-btn" onclick="setQuizType('word')">Îã®Ïñ¥ ÌÄ¥Ï¶à</button>
                    </div>
                    <div class="quiz-score">
                        <span class="correct">‚≠ï <span id="correctCount">0</span></span>
                        <span class="wrong">‚ùå <span id="wrongCount">0</span></span>
                    </div>
                    <div class="quiz-question" id="quizQuestion">a (ÏïÑ)</div>
                    <div class="quiz-hint" id="quizHint"></div>
                    <div class="quiz-canvas-container">
                        <canvas id="quizCanvas"></canvas>
                        <canvas id="quizGuideCanvas" class="quiz-guide-canvas"></canvas>
                    </div>
                    <div class="quiz-controls-row">
                        <button class="btn-clear" onclick="clearQuizCanvas()">üóë</button>
                        <button class="btn-show-answer" onclick="showAnswer()">üëÅ</button>
                        <button class="btn-correct" onclick="markCorrect()">‚≠ï</button>
                        <button class="btn-wrong" onclick="markWrong()">‚ùå</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const basicData = {
            a: [{char:'„ÅÇ',romaji:'a',korean:'ÏïÑ',strokes:'3Ìöç'},{char:'„ÅÑ',romaji:'i',korean:'Ïù¥',strokes:'2Ìöç'},{char:'„ÅÜ',romaji:'u',korean:'Ïö∞',strokes:'2Ìöç'},{char:'„Åà',romaji:'e',korean:'Ïóê',strokes:'2Ìöç'},{char:'„Åä',romaji:'o',korean:'Ïò§',strokes:'3Ìöç'}],
            ka: [{char:'„Åã',romaji:'ka',korean:'Ïπ¥',strokes:'3Ìöç'},{char:'„Åå',romaji:'ga',korean:'Í∞Ä',strokes:'ÌÉÅÏ†ê'},{char:'„Åç',romaji:'ki',korean:'ÌÇ§',strokes:'4Ìöç'},{char:'„Åé',romaji:'gi',korean:'Í∏∞',strokes:'ÌÉÅÏ†ê'},{char:'„Åè',romaji:'ku',korean:'Ïø†',strokes:'1Ìöç'},{char:'„Åê',romaji:'gu',korean:'Íµ¨',strokes:'ÌÉÅÏ†ê'},{char:'„Åë',romaji:'ke',korean:'ÏºÄ',strokes:'3Ìöç'},{char:'„Åí',romaji:'ge',korean:'Í≤å',strokes:'ÌÉÅÏ†ê'},{char:'„Åì',romaji:'ko',korean:'ÏΩî',strokes:'2Ìöç'},{char:'„Åî',romaji:'go',korean:'Í≥†',strokes:'ÌÉÅÏ†ê'}],
            sa: [{char:'„Åï',romaji:'sa',korean:'ÏÇ¨',strokes:'3Ìöç'},{char:'„Åñ',romaji:'za',korean:'Ïûê',strokes:'ÌÉÅÏ†ê'},{char:'„Åó',romaji:'shi',korean:'Ïãú',strokes:'1Ìöç'},{char:'„Åò',romaji:'ji',korean:'ÏßÄ',strokes:'ÌÉÅÏ†ê'},{char:'„Åô',romaji:'su',korean:'Ïä§',strokes:'2Ìöç'},{char:'„Åö',romaji:'zu',korean:'Ï¶à',strokes:'ÌÉÅÏ†ê'},{char:'„Åõ',romaji:'se',korean:'ÏÑ∏',strokes:'3Ìöç'},{char:'„Åú',romaji:'ze',korean:'Ï†ú',strokes:'ÌÉÅÏ†ê'},{char:'„Åù',romaji:'so',korean:'ÏÜå',strokes:'1Ìöç'},{char:'„Åû',romaji:'zo',korean:'Ï°∞',strokes:'ÌÉÅÏ†ê'}],
            ta: [{char:'„Åü',romaji:'ta',korean:'ÌÉÄ',strokes:'4Ìöç'},{char:'„Å†',romaji:'da',korean:'Îã§',strokes:'ÌÉÅÏ†ê'},{char:'„Å°',romaji:'chi',korean:'Ïπò',strokes:'2Ìöç'},{char:'„Å¢',romaji:'ji',korean:'ÏßÄ',strokes:'ÌÉÅÏ†ê'},{char:'„Å§',romaji:'tsu',korean:'Ï∏†',strokes:'1Ìöç'},{char:'„Å•',romaji:'zu',korean:'Ï¶à',strokes:'ÌÉÅÏ†ê'},{char:'„Å¶',romaji:'te',korean:'ÌÖå',strokes:'1Ìöç'},{char:'„Åß',romaji:'de',korean:'Îç∞',strokes:'ÌÉÅÏ†ê'},{char:'„Å®',romaji:'to',korean:'ÌÜ†',strokes:'2Ìöç'},{char:'„Å©',romaji:'do',korean:'ÎèÑ',strokes:'ÌÉÅÏ†ê'}],
            na: [{char:'„Å™',romaji:'na',korean:'ÎÇò',strokes:'4Ìöç'},{char:'„Å´',romaji:'ni',korean:'Îãà',strokes:'3Ìöç'},{char:'„Å¨',romaji:'nu',korean:'ÎàÑ',strokes:'2Ìöç'},{char:'„Å≠',romaji:'ne',korean:'ÎÑ§',strokes:'2Ìöç'},{char:'„ÅÆ',romaji:'no',korean:'ÎÖ∏',strokes:'1Ìöç'}],
            ha: [{char:'„ÅØ',romaji:'ha',korean:'Ìïò',strokes:'3Ìöç'},{char:'„Å∞',romaji:'ba',korean:'Î∞î',strokes:'ÌÉÅÏ†ê'},{char:'„Å±',romaji:'pa',korean:'Ìåå',strokes:'Î∞òÌÉÅÏ†ê'},{char:'„Å≤',romaji:'hi',korean:'Ìûà',strokes:'1Ìöç'},{char:'„Å≥',romaji:'bi',korean:'ÎπÑ',strokes:'ÌÉÅÏ†ê'},{char:'„Å¥',romaji:'pi',korean:'Ìîº',strokes:'Î∞òÌÉÅÏ†ê'},{char:'„Åµ',romaji:'fu',korean:'ÌõÑ',strokes:'4Ìöç'},{char:'„Å∂',romaji:'bu',korean:'Î∂Ä',strokes:'ÌÉÅÏ†ê'},{char:'„Å∑',romaji:'pu',korean:'Ìë∏',strokes:'Î∞òÌÉÅÏ†ê'},{char:'„Å∏',romaji:'he',korean:'Ìó§',strokes:'1Ìöç'},{char:'„Åπ',romaji:'be',korean:'Î≤†',strokes:'ÌÉÅÏ†ê'},{char:'„Å∫',romaji:'pe',korean:'Ìéò',strokes:'Î∞òÌÉÅÏ†ê'},{char:'„Åª',romaji:'ho',korean:'Ìò∏',strokes:'4Ìöç'},{char:'„Åº',romaji:'bo',korean:'Î≥¥',strokes:'ÌÉÅÏ†ê'},{char:'„ÅΩ',romaji:'po',korean:'Ìè¨',strokes:'Î∞òÌÉÅÏ†ê'}],
            ma: [{char:'„Åæ',romaji:'ma',korean:'Îßà',strokes:'3Ìöç'},{char:'„Åø',romaji:'mi',korean:'ÎØ∏',strokes:'2Ìöç'},{char:'„ÇÄ',romaji:'mu',korean:'Î¨¥',strokes:'3Ìöç'},{char:'„ÇÅ',romaji:'me',korean:'Î©î',strokes:'2Ìöç'},{char:'„ÇÇ',romaji:'mo',korean:'Î™®',strokes:'3Ìöç'}],
            ya: [{char:'„ÇÑ',romaji:'ya',korean:'Ïïº',strokes:'3Ìöç'},{char:'„ÇÜ',romaji:'yu',korean:'Ïú†',strokes:'2Ìöç'},{char:'„Çà',romaji:'yo',korean:'Ïöî',strokes:'2Ìöç'}],
            ra: [{char:'„Çâ',romaji:'ra',korean:'Îùº',strokes:'2Ìöç'},{char:'„Çä',romaji:'ri',korean:'Î¶¨',strokes:'2Ìöç'},{char:'„Çã',romaji:'ru',korean:'Î£®',strokes:'1Ìöç'},{char:'„Çå',romaji:'re',korean:'Î†à',strokes:'2Ìöç'},{char:'„Çç',romaji:'ro',korean:'Î°ú',strokes:'1Ìöç'}],
            wa: [{char:'„Çè',romaji:'wa',korean:'ÏôÄ',strokes:'2Ìöç'},{char:'„Çí',romaji:'wo',korean:'Ïò§',strokes:'3Ìöç'},{char:'„Çì',romaji:'n',korean:'Ïùë',strokes:'1Ìöç'}]
        };
        const extendedData = {
            kya: [{char:'„Åç„ÇÉ',romaji:'kya',korean:'Ï∫¨',strokes:'„Åç+„ÇÉ'},{char:'„Åç„ÇÖ',romaji:'kyu',korean:'ÌÅê',strokes:'„Åç+„ÇÖ'},{char:'„Åç„Çá',romaji:'kyo',korean:'ÏøÑ',strokes:'„Åç+„Çá'},{char:'„Åé„ÇÉ',romaji:'gya',korean:'Í∞∏',strokes:'„Åé+„ÇÉ'},{char:'„Åé„ÇÖ',romaji:'gyu',korean:'Í∑ú',strokes:'„Åé+„ÇÖ'},{char:'„Åé„Çá',romaji:'gyo',korean:'Íµê',strokes:'„Åé+„Çá'}],
            sha: [{char:'„Åó„ÇÉ',romaji:'sha',korean:'ÏÉ§',strokes:'„Åó+„ÇÉ'},{char:'„Åó„ÇÖ',romaji:'shu',korean:'Ïäà',strokes:'„Åó+„ÇÖ'},{char:'„Åó„Çá',romaji:'sho',korean:'Ïáº',strokes:'„Åó+„Çá'},{char:'„Åò„ÇÉ',romaji:'ja',korean:'Ïüà',strokes:'„Åò+„ÇÉ'},{char:'„Åò„ÇÖ',romaji:'ju',korean:'Ï•¨',strokes:'„Åò+„ÇÖ'},{char:'„Åò„Çá',romaji:'jo',korean:'Ï£†',strokes:'„Åò+„Çá'}],
            cha: [{char:'„Å°„ÇÉ',romaji:'cha',korean:'Ï±†',strokes:'„Å°+„ÇÉ'},{char:'„Å°„ÇÖ',romaji:'chu',korean:'Ï∏Ñ',strokes:'„Å°+„ÇÖ'},{char:'„Å°„Çá',romaji:'cho',korean:'Ïµ∏',strokes:'„Å°+„Çá'}],
            nya: [{char:'„Å´„ÇÉ',romaji:'nya',korean:'ÎÉê',strokes:'„Å´+„ÇÉ'},{char:'„Å´„ÇÖ',romaji:'nyu',korean:'Îâ¥',strokes:'„Å´+„ÇÖ'},{char:'„Å´„Çá',romaji:'nyo',korean:'Îá®',strokes:'„Å´+„Çá'}],
            hya: [{char:'„Å≤„ÇÉ',romaji:'hya',korean:'Ìñê',strokes:'„Å≤+„ÇÉ'},{char:'„Å≤„ÇÖ',romaji:'hyu',korean:'Ìú¥',strokes:'„Å≤+„ÇÖ'},{char:'„Å≤„Çá',romaji:'hyo',korean:'Ìö®',strokes:'„Å≤+„Çá'},{char:'„Å≥„ÇÉ',romaji:'bya',korean:'Î±å',strokes:'„Å≥+„ÇÉ'},{char:'„Å≥„ÇÖ',romaji:'byu',korean:'Î∑∞',strokes:'„Å≥+„ÇÖ'},{char:'„Å≥„Çá',romaji:'byo',korean:'Îµ§',strokes:'„Å≥+„Çá'},{char:'„Å¥„ÇÉ',romaji:'pya',korean:'ÌçÑ',strokes:'„Å¥+„ÇÉ'},{char:'„Å¥„ÇÖ',romaji:'pyu',korean:'Ìì®',strokes:'„Å¥+„ÇÖ'},{char:'„Å¥„Çá',romaji:'pyo',korean:'Ìëú',strokes:'„Å¥+„Çá'}],
            mya: [{char:'„Åø„ÇÉ',romaji:'mya',korean:'Î®Ä',strokes:'„Åø+„ÇÉ'},{char:'„Åø„ÇÖ',romaji:'myu',korean:'ÎÆ§',strokes:'„Åø+„ÇÖ'},{char:'„Åø„Çá',romaji:'myo',korean:'Î¨ò',strokes:'„Åø+„Çá'}],
            rya: [{char:'„Çä„ÇÉ',romaji:'rya',korean:'Îû¥',strokes:'„Çä+„ÇÉ'},{char:'„Çä„ÇÖ',romaji:'ryu',korean:'Î•ò',strokes:'„Çä+„ÇÖ'},{char:'„Çä„Çá',romaji:'ryo',korean:'Î£å',strokes:'„Çä+„Çá'}]
        };
        const wordData = [
            {word:'„ÅÇ„ÇÅ',romaji:'ame',korean:'ÎπÑ/ÏÇ¨ÌÉï'},{word:'„ÅÑ„Å¨',romaji:'inu',korean:'Í∞ú'},{word:'„ÅÜ„Åø',romaji:'umi',korean:'Î∞îÎã§'},
            {word:'„Åà„Åç',romaji:'eki',korean:'Ïó≠'},{word:'„Åä„Åã',romaji:'oka',korean:'Ïñ∏Îçï'},{word:'„Åã„Åï',romaji:'kasa',korean:'Ïö∞ÏÇ∞'},
            {word:'„Åç„Åè',romaji:'kiku',korean:'Íµ≠Ìôî'},{word:'„Åè„ÇÇ',romaji:'kumo',korean:'Íµ¨Î¶Ñ'},{word:'„Åì„Åà',romaji:'koe',korean:'Î™©ÏÜåÎ¶¨'},
            {word:'„Åï„Åè„Çâ',romaji:'sakura',korean:'Î≤öÍΩÉ'},{word:'„Åó„Çç',romaji:'shiro',korean:'Ìù∞ÏÉâ'},{word:'„Åô„Åó',romaji:'sushi',korean:'Ï¥àÎ∞•'},
            {word:'„Åõ„Åã„ÅÑ',romaji:'sekai',korean:'ÏÑ∏Í≥Ñ'},{word:'„Åù„Çâ',romaji:'sora',korean:'ÌïòÎäò'},{word:'„Åü„Åπ„Çã',romaji:'taberu',korean:'Î®πÎã§'},
            {word:'„Å°„Åö',romaji:'chizu',korean:'ÏßÄÎèÑ'},{word:'„Å§„Åç',romaji:'tsuki',korean:'Îã¨'},{word:'„Å¶„Åå„Åø',romaji:'tegami',korean:'Ìé∏ÏßÄ'},
            {word:'„Å®„ÇÇ„Å†„Å°',romaji:'tomodachi',korean:'ÏπúÍµ¨'},{word:'„Å™„Å§',romaji:'natsu',korean:'Ïó¨Î¶Ñ'},{word:'„Å´„Åè',romaji:'niku',korean:'Í≥†Í∏∞'},
            {word:'„Å≠„Åì',romaji:'neko',korean:'Í≥†ÏñëÏù¥'},{word:'„ÅÆ„Åø„ÇÇ„ÅÆ',romaji:'nomimono',korean:'ÏùåÎ£å'},{word:'„ÅØ„Å™',romaji:'hana',korean:'ÍΩÉ'},
            {word:'„Å≤„Å®',romaji:'hito',korean:'ÏÇ¨Îûå'},{word:'„Åµ„Å≠',romaji:'fune',korean:'Î∞∞'},{word:'„Å∏„ÇÑ',romaji:'heya',korean:'Î∞©'},
            {word:'„Åª„Åó',romaji:'hoshi',korean:'Î≥Ñ'},{word:'„Åæ„Å°',romaji:'machi',korean:'ÎßàÏùÑ'},{word:'„Åø„Åö',romaji:'mizu',korean:'Î¨º'},
            {word:'„ÇÄ„Åó',romaji:'mushi',korean:'Î≤åÎ†à'},{word:'„ÇÅ„Åå„Å≠',romaji:'megane',korean:'ÏïàÍ≤Ω'},{word:'„ÇÇ„Çä',romaji:'mori',korean:'Ïà≤'},
            {word:'„ÇÑ„Åæ',romaji:'yama',korean:'ÏÇ∞'},{word:'„ÇÜ„Åç',romaji:'yuki',korean:'Îàà'},{word:'„Çà„Çã',romaji:'yoru',korean:'Î∞§'},
            {word:'„Çä„Çì„Åî',romaji:'ringo',korean:'ÏÇ¨Í≥º'},{word:'„Çè„Åü„Åó',romaji:'watashi',korean:'ÎÇò'},{word:'„Åä„Çì„Åå„Åè',romaji:'ongaku',korean:'ÏùåÏïÖ'}
        ];
        const basicCategories = ['a','ka','sa','ta','na','ha','ma','ya','ra','wa'];
        const extendedCategories = ['kya','sha','cha','nya','hya','mya','rya'];
        const categoryLabels = {a:'„ÅÇ',ka:'„Åã',sa:'„Åï',ta:'„Åü',na:'„Å™',ha:'„ÅØ',ma:'„Åæ',ya:'„ÇÑ',ra:'„Çâ',wa:'„Çè',kya:'„Åç„ÇÉ',sha:'„Åó„ÇÉ',cha:'„Å°„ÇÉ',nya:'„Å´„ÇÉ',hya:'„Å≤„ÇÉ',mya:'„Åø„ÇÉ',rya:'„Çä„ÇÉ'};
        
        let currentTab='basic',currentCategory='a',currentIndex=0,isDrawing=false,showGuide=true,currentFont='Noto Sans JP';
        let checkedChars=JSON.parse(localStorage.getItem('hiraganaCheckedChars')||'{}');
        const canvas=document.getElementById('drawingCanvas'),guideCanvas=document.getElementById('guideCanvas');
        const ctx=canvas.getContext('2d'),guideCtx=guideCanvas.getContext('2d');
        
        function getCurrentData(){return currentTab==='basic'?basicData:extendedData;}
        function getCurrentChar(){return getCurrentData()[currentCategory][currentIndex];}
        function toggleFontDropdown(){document.getElementById('fontDropdown').classList.toggle('show');}
        function setFont(f){currentFont=f;document.documentElement.style.setProperty('--jp-font',`'${f}',sans-serif`);document.querySelectorAll('.font-option').forEach(o=>o.classList.remove('active'));event.target.classList.add('active');document.getElementById('fontDropdown').classList.remove('show');localStorage.setItem('hiraganaFont',f);drawGuideCharacter();}
        document.addEventListener('click',e=>{if(!e.target.closest('.font-dropdown'))document.getElementById('fontDropdown').classList.remove('show');});
        
        function initCanvas(){const r=canvas.parentElement.getBoundingClientRect();canvas.width=guideCanvas.width=r.width;canvas.height=guideCanvas.height=250;ctx.lineWidth=3;ctx.lineCap=ctx.lineJoin='round';ctx.strokeStyle='#667eea';drawGuideCharacter();}
        function drawGuideCharacter(){const c=getCurrentChar();guideCtx.clearRect(0,0,guideCanvas.width,guideCanvas.height);const fs=c.char.length===1?guideCanvas.height*0.8:guideCanvas.height*0.5;guideCtx.font=`bold ${fs}px '${currentFont}',sans-serif`;guideCtx.fillStyle='#764ba2';guideCtx.textAlign='center';guideCtx.textBaseline='middle';guideCtx.fillText(c.char,guideCanvas.width/2,guideCanvas.height/2);}
        function getPos(e){const r=canvas.getBoundingClientRect(),t=e.touches?e.touches[0]:e;return{x:t.clientX-r.left,y:t.clientY-r.top};}
        function startDrawing(e){e.preventDefault();isDrawing=true;const p=getPos(e);ctx.beginPath();ctx.moveTo(p.x,p.y);}
        function draw(e){if(!isDrawing)return;e.preventDefault();const p=getPos(e);ctx.lineTo(p.x,p.y);ctx.stroke();}
        function stopDrawing(){isDrawing=false;}
        function clearCanvas(){ctx.clearRect(0,0,canvas.width,canvas.height);}
        function toggleGuide(){showGuide=!showGuide;guideCanvas.style.opacity=showGuide?'0.3':'0';}
        function toggleCheck(){const k=getCurrentChar().char;checkedChars[k]?delete checkedChars[k]:checkedChars[k]=true;localStorage.setItem('hiraganaCheckedChars',JSON.stringify(checkedChars));updateCheckDisplay();updateCategoryButtons();}
        function updateCheckDisplay(){const k=getCurrentChar().char,c=checkedChars[k],m=document.getElementById('checkMark'),b=document.getElementById('checkBtn');if(c){m.classList.add('show');b.classList.add('checked');b.textContent='‚úì ÏôÑÎ£åÎê®';}else{m.classList.remove('show');b.classList.remove('checked');b.textContent='‚úì ÏôÑÎ£å';}}
        function nextCharacter(){const d=getCurrentData();currentIndex=(currentIndex+1)%d[currentCategory].length;updateDisplay();clearCanvas();drawGuideCharacter();}
        function prevCharacter(){const d=getCurrentData();currentIndex=(currentIndex-1+d[currentCategory].length)%d[currentCategory].length;updateDisplay();clearCanvas();drawGuideCharacter();}
        function selectCategory(c){currentCategory=c;currentIndex=0;document.querySelectorAll('.category-btn').forEach(b=>b.classList.remove('active'));event.target.closest('.category-btn').classList.add('active');updateDisplay();clearCanvas();drawGuideCharacter();}
        function selectTab(t){currentTab=t;document.querySelectorAll('.level-btn').forEach(b=>b.classList.remove('active'));event.target.classList.add('active');updateCategoryButtons();currentCategory=(currentTab==='basic'?basicCategories:extendedCategories)[0];currentIndex=0;updateDisplay();clearCanvas();drawGuideCharacter();}
        function updateCategoryButtons(){const s=document.getElementById('categorySelector'),cats=currentTab==='basic'?basicCategories:extendedCategories,d=getCurrentData();s.innerHTML='';cats.forEach(c=>{const b=document.createElement('button');b.className='category-btn jp-text'+(c===currentCategory?' active':'');const cd=d[c];let cnt=0;cd.forEach(i=>{if(checkedChars[i.char])cnt++;});b.innerHTML=`${categoryLabels[c]}<span class="cat-progress">${cnt>0?cnt+'/'+cd.length:''}</span>`;b.onclick=function(){selectCategory(c);};s.appendChild(b);});}
        function updateDisplay(){const c=getCurrentChar(),d=getCurrentData();document.getElementById('currentCharacter').innerHTML=`${c.char}<span class="check-mark" id="checkMark">‚úì</span>`;document.getElementById('characterInfo').textContent=`${c.romaji} (${c.korean})`;document.getElementById('strokeOrder').textContent=`ÌöçÏàú: ${c.strokes}`;document.getElementById('progressText').textContent=`${currentIndex+1} / ${d[currentCategory].length}`;updateCheckDisplay();}
        function openChart(){document.getElementById('chartModal').classList.add('show');document.body.style.overflow='hidden';}
        function closeChart(){document.getElementById('chartModal').classList.remove('show');document.body.style.overflow='';}
        function switchTableTab(n){document.querySelectorAll('.table-tab').forEach(b=>b.classList.remove('active'));event.target.classList.add('active');document.querySelectorAll('.table-section').forEach(s=>s.classList.remove('active'));document.getElementById(n+'-section').classList.add('active');}
        
        let quizType='char',quizCorrect=0,quizWrong=0,currentQuizItem=null,quizCanvas,quizCtx,quizGuideCanvas,quizGuideCtx,isQuizDrawing=false;
        function openQuiz(){document.getElementById('quizModal').classList.add('show');document.body.style.overflow='hidden';initQuizCanvas();nextQuizQuestion();}
        function closeQuiz(){document.getElementById('quizModal').classList.remove('show');document.body.style.overflow='';}
        function setQuizType(t){quizType=t;quizCorrect=quizWrong=0;document.getElementById('correctCount').textContent='0';document.getElementById('wrongCount').textContent='0';document.querySelectorAll('.quiz-type-btn').forEach(b=>b.classList.remove('active'));event.target.classList.add('active');nextQuizQuestion();}
        function initQuizCanvas(){quizCanvas=document.getElementById('quizCanvas');quizCtx=quizCanvas.getContext('2d');quizGuideCanvas=document.getElementById('quizGuideCanvas');quizGuideCtx=quizGuideCanvas.getContext('2d');const r=quizCanvas.parentElement.getBoundingClientRect();quizCanvas.width=quizGuideCanvas.width=r.width;quizCanvas.height=quizGuideCanvas.height=180;quizCtx.lineWidth=3;quizCtx.lineCap=quizCtx.lineJoin='round';quizCtx.strokeStyle='#20c997';quizCanvas.onmousedown=startQuizDrawing;quizCanvas.onmousemove=quizDraw;quizCanvas.onmouseup=quizCanvas.onmouseout=stopQuizDrawing;quizCanvas.ontouchstart=startQuizDrawing;quizCanvas.ontouchmove=quizDraw;quizCanvas.ontouchend=stopQuizDrawing;}
        function getQuizPos(e){const r=quizCanvas.getBoundingClientRect(),t=e.touches?e.touches[0]:e;return{x:t.clientX-r.left,y:t.clientY-r.top};}
        function startQuizDrawing(e){e.preventDefault();isQuizDrawing=true;const p=getQuizPos(e);quizCtx.beginPath();quizCtx.moveTo(p.x,p.y);}
        function quizDraw(e){if(!isQuizDrawing)return;e.preventDefault();const p=getQuizPos(e);quizCtx.lineTo(p.x,p.y);quizCtx.stroke();}
        function stopQuizDrawing(){isQuizDrawing=false;}
        function clearQuizCanvas(){quizCtx.clearRect(0,0,quizCanvas.width,quizCanvas.height);}
        function getAllChars(){let a=[];basicCategories.forEach(c=>a=a.concat(basicData[c]));return a;}
        function nextQuizQuestion(){if(quizType==='char'){const a=getAllChars();currentQuizItem=a[Math.floor(Math.random()*a.length)];document.getElementById('quizQuestion').textContent=`${currentQuizItem.romaji} (${currentQuizItem.korean})`;document.getElementById('quizHint').textContent='';}else{currentQuizItem=wordData[Math.floor(Math.random()*wordData.length)];document.getElementById('quizQuestion').textContent=currentQuizItem.korean;document.getElementById('quizHint').textContent=`(${currentQuizItem.romaji})`;}quizGuideCanvas.classList.remove('show');clearQuizCanvas();drawQuizGuide();}
        function drawQuizGuide(){quizGuideCtx.clearRect(0,0,quizGuideCanvas.width,quizGuideCanvas.height);const ans=quizType==='char'?currentQuizItem.char:currentQuizItem.word;const fs=ans.length<=2?quizGuideCanvas.height*0.6:Math.min(quizGuideCanvas.width/ans.length*1.5,quizGuideCanvas.height*0.5);quizGuideCtx.font=`bold ${fs}px '${currentFont}',sans-serif`;quizGuideCtx.fillStyle='#20c997';quizGuideCtx.textAlign='center';quizGuideCtx.textBaseline='middle';quizGuideCtx.fillText(ans,quizGuideCanvas.width/2,quizGuideCanvas.height/2);}
        function showAnswer(){quizGuideCanvas.classList.add('show');}
        function markCorrect(){quizCorrect++;document.getElementById('correctCount').textContent=quizCorrect;nextQuizQuestion();}
        function markWrong(){quizWrong++;document.getElementById('wrongCount').textContent=quizWrong;nextQuizQuestion();}
        
        document.addEventListener('keydown',e=>{const c=document.getElementById('chartModal').classList.contains('show'),q=document.getElementById('quizModal').classList.contains('show');if(e.key==='Escape'){closeChart();closeQuiz();return;}if(c||q)return;switch(e.key){case'ArrowLeft':e.preventDefault();prevCharacter();break;case'ArrowRight':e.preventDefault();nextCharacter();break;case' ':e.preventDefault();clearCanvas();break;case'Enter':e.preventDefault();toggleCheck();break;case'g':case'G':toggleGuide();break;}});
        document.getElementById('chartModal').addEventListener('click',e=>{if(e.target===document.getElementById('chartModal'))closeChart();});
        document.getElementById('quizModal').addEventListener('click',e=>{if(e.target===document.getElementById('quizModal'))closeQuiz();});
        canvas.addEventListener('mousedown',startDrawing);canvas.addEventListener('mousemove',draw);canvas.addEventListener('mouseup',stopDrawing);canvas.addEventListener('mouseout',stopDrawing);
        canvas.addEventListener('touchstart',startDrawing);canvas.addEventListener('touchmove',draw);canvas.addEventListener('touchend',stopDrawing);
        window.addEventListener('resize',initCanvas);
        function goBack(){window.location.href='index.html';}
        const sf=localStorage.getItem('hiraganaFont');if(sf){currentFont=sf;document.documentElement.style.setProperty('--jp-font',`'${sf}',sans-serif`);document.querySelectorAll('.font-option').forEach(o=>o.classList.toggle('active',o.textContent.trim()===sf));}
        updateCategoryButtons();initCanvas();updateDisplay();
    </script>
</body>
</html>
