<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íˆë¼ê°€ë‚˜ ë”°ë¼ì“°ê¸°</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&family=Noto+Sans+JP:wght@400;700&family=Zen+Maru+Gothic:wght@400;700&family=Kosugi+Maru&family=M+PLUS+Rounded+1c:wght@400;700&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --jp-font: 'Noto Sans JP', sans-serif; }
        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .jp-text { font-family: var(--jp-font); }
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 30px;
            max-width: 500px;
            width: 100%;
        }
        h1 { color: #667eea; font-size: 22px; flex: 1; white-space: nowrap; }
        .header { display: flex; align-items: center; margin-bottom: 20px; gap: 10px; }
        .back-button, .font-button {
            background: #e9ecef; border: none; border-radius: 8px;
            width: 36px; height: 36px; cursor: pointer; font-size: 16px;
            transition: all 0.3s; flex-shrink: 0;
            display: flex; align-items: center; justify-content: center;
        }
        .back-button:hover { background: #dee2e6; transform: translateX(-3px); }
        .font-button:hover { background: #dee2e6; }
        .header-buttons { display: flex; gap: 8px; }
        .chart-button, .quiz-button {
            background: linear-gradient(135deg, #ff6b9d 0%, #c44569 100%);
            border: none; border-radius: 8px; width: 36px; height: 36px;
            cursor: pointer; font-size: 16px; transition: all 0.3s;
            flex-shrink: 0; display: flex; align-items: center; justify-content: center; color: white;
        }
        .quiz-button { background: linear-gradient(135deg, #20c997 0%, #12b886 100%); }
        .chart-button:hover, .quiz-button:hover { transform: scale(1.1); box-shadow: 0 4px 15px rgba(196, 69, 105, 0.4); }
        .quiz-button:hover { box-shadow: 0 4px 15px rgba(32, 201, 151, 0.4); }
        .character-display { text-align: center; margin-bottom: 20px; }
        .current-character {
            font-size: 80px; color: #764ba2; font-weight: bold;
            margin-bottom: 10px; position: relative; display: inline-block;
        }
        .check-mark {
            position: absolute; top: -5px; right: -25px;
            font-size: 24px; color: #51cf66; display: none;
        }
        .check-mark.show { display: block; animation: popIn 0.3s ease; }
        @keyframes popIn { 0% { transform: scale(0); } 50% { transform: scale(1.3); } 100% { transform: scale(1); } }
        .character-info { font-size: 18px; color: #666; }
        .canvas-container {
            position: relative; background: #f8f9fa; border-radius: 15px;
            margin-bottom: 20px; border: 3px solid #e0e0e0; overflow: hidden;
        }
        #drawingCanvas { display: block; width: 100%; height: 250px; cursor: crosshair; touch-action: none; }
        .guide-canvas { position: absolute; top: 0; left: 0; pointer-events: none; opacity: 0.3; }
        .controls { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 10px; }
        .controls-three { grid-template-columns: repeat(3, 1fr); }
        .controls-three button { padding: 12px 8px; font-size: 13px; }
        button {
            padding: 14px 10px; border: none; border-radius: 10px;
            font-size: 15px; font-weight: bold; cursor: pointer;
            transition: all 0.3s; white-space: nowrap;
        }
        .btn-clear { background: #ff6b6b; color: white; }
        .btn-clear:hover { background: #ff5252; transform: translateY(-2px); }
        .btn-next { background: #51cf66; color: white; }
        .btn-next:hover { background: #40c057; transform: translateY(-2px); }
        .btn-prev { background: #74c0fc; color: white; }
        .btn-prev:hover { background: #4dabf7; transform: translateY(-2px); }
        .btn-show-guide { background: #ffd43b; color: #333; }
        .btn-show-guide:hover { background: #fcc419; transform: translateY(-2px); }
        .btn-check { background: #845ef7; color: white; }
        .btn-check:hover { background: #7950f2; transform: translateY(-2px); }
        .btn-check.checked { background: #51cf66; }
        .progress { text-align: center; color: #666; font-size: 14px; margin-bottom: 10px; }
        .level-selector { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px; }
        .level-btn {
            padding: 12px 10px; background: #e9ecef; color: #495057;
            border: 2px solid transparent; border-radius: 10px;
            font-size: 14px; font-weight: bold; cursor: pointer;
            transition: all 0.3s; white-space: nowrap;
        }
        .level-btn.active { background: #667eea; color: white; border-color: #667eea; }
        .level-btn:hover { transform: translateY(-2px); }
        .category-selector { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin-bottom: 20px; }
        .category-btn {
            padding: 10px 5px; background: #e9ecef; color: #495057;
            border: 2px solid transparent; font-size: 16px;
            border-radius: 8px; cursor: pointer; transition: all 0.3s; position: relative;
        }
        .category-btn.active { background: #667eea; color: white; border-color: #667eea; }
        .category-btn .cat-progress {
            position: absolute; bottom: 2px; left: 50%; transform: translateX(-50%);
            font-size: 8px; color: #51cf66;
        }
        .stroke-order {
            text-align: center; margin-top: 10px; padding: 12px;
            background: #e7f5ff; border-radius: 8px; font-size: 14px;
            color: #1864ab; min-height: 60px;
            display: flex; align-items: center; justify-content: center; line-height: 1.5;
        }
        .shortcut-hint { text-align: center; margin-top: 10px; font-size: 12px; color: #adb5bd; }
        .shortcut-hint kbd { background: #e9ecef; padding: 2px 6px; border-radius: 4px; font-family: monospace; margin: 0 2px; }
        .font-dropdown { position: relative; display: inline-block; }
        .font-dropdown-content {
            display: none; position: absolute; top: 100%; left: 0;
            background: white; min-width: 160px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2); border-radius: 8px; z-index: 100; overflow: hidden;
        }
        .font-dropdown-content.show { display: block; }
        .font-option { padding: 10px 15px; cursor: pointer; transition: background 0.2s; font-size: 14px; }
        .font-option:hover { background: #f0f0f0; }
        .font-option.active { background: #667eea; color: white; }
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(5px);
            z-index: 1000; justify-content: center; align-items: center;
            padding: 20px; animation: fadeIn 0.3s ease;
        }
        .modal-overlay.show { display: flex; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px) scale(0.95); } to { opacity: 1; transform: translateY(0) scale(1); } }
        .modal-content {
            background: white; border-radius: 20px; max-width: 95vw; max-height: 90vh;
            overflow: auto; position: relative; animation: slideUp 0.3s ease;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.4);
        }
        .modal-header {
            position: sticky; top: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 20px 25px;
            display: flex; justify-content: space-between; align-items: center;
            border-radius: 20px 20px 0 0; z-index: 10;
        }
        .modal-header h2 { font-size: 20px; display: flex; align-items: center; gap: 10px; }
        .modal-close {
            background: rgba(255, 255, 255, 0.2); border: none; color: white;
            width: 36px; height: 36px; border-radius: 50%; font-size: 20px;
            cursor: pointer; transition: all 0.3s;
            display: flex; align-items: center; justify-content: center;
        }
        .modal-close:hover { background: rgba(255, 255, 255, 0.3); transform: rotate(90deg); }
        .modal-body { padding: 25px; }
        .hiragana-table { width: 100%; border-collapse: collapse; font-size: 14px; }
        .hiragana-table th {
            background: linear-gradient(135deg, #ffeef8 0%, #f8e1eb 100%);
            padding: 10px 6px; font-weight: bold; color: #764ba2;
            border: 1px solid #e0c4d4; font-size: 13px;
        }
        .hiragana-table td {
            padding: 8px 4px; text-align: center; border: 1px solid #e9ecef;
            vertical-align: middle; transition: all 0.2s;
        }
        .hiragana-table td:hover { background: #f0e6ff; transform: scale(1.05); }
        .hiragana-table .row-header {
            background: linear-gradient(135deg, #ffeef8 0%, #f8e1eb 100%);
            font-weight: bold; color: #764ba2; font-size: 13px;
        }
        .char-cell { display: flex; flex-direction: column; align-items: center; gap: 2px; }
        .char-main { font-size: 24px; color: #333; font-weight: 500; }
        .char-romaji { font-size: 10px; color: #888; }
        .empty-cell { background: #f8f9fa; color: #ccc; }
        .table-tabs { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .table-tab {
            padding: 10px 20px; background: #e9ecef; border: none; border-radius: 25px;
            font-size: 14px; font-weight: bold; cursor: pointer; transition: all 0.3s; color: #495057;
        }
        .table-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        .table-tab:hover { transform: translateY(-2px); }
        .table-section { display: none; }
        .table-section.active { display: block; }
        .section-title {
            font-size: 16px; color: #667eea; margin-bottom: 15px;
            padding-bottom: 10px; border-bottom: 2px solid #e9ecef;
            display: flex; align-items: center; gap: 8px;
        }
        .yoon-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .yoon-table th, .yoon-table td { padding: 8px 6px; text-align: center; border: 1px solid #e9ecef; }
        .yoon-table th { background: linear-gradient(135deg, #e7f5ff 0%, #d0ebff 100%); color: #1864ab; font-size: 12px; }
        .table-scroll { overflow-x: auto; margin-bottom: 15px; }
        .combined-table { min-width: 900px; }
        .combined-table th, .combined-table td { min-width: 55px; padding: 6px 4px; }
        .dakuon-header { background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%) !important; color: #e65100 !important; }
        .handakuon-header { background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%) !important; color: #2e7d32 !important; }
        .dakuon-cell { background: #fff8e1; }
        .handakuon-cell { background: #e8f5e9; }
        .dakuon-row td { background: #fff8e1; }
        .handakuon-row td { background: #e8f5e9; }
        .legend {
            display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;
            margin-top: 15px; padding: 12px; background: #f8f9fa; border-radius: 10px;
        }
        .legend-item { display: flex; align-items: center; gap: 6px; font-size: 13px; color: #495057; }
        .legend-box { width: 16px; height: 16px; border-radius: 4px; border: 1px solid #dee2e6; }
        .seion-box { background: white; }
        .dakuon-box { background: #fff8e1; }
        .handakuon-box { background: #e8f5e9; }
        .quiz-modal .modal-header { background: linear-gradient(135deg, #20c997 0%, #12b886 100%); }
        .quiz-container { text-align: center; }
        .quiz-type-selector { display: flex; gap: 8px; justify-content: center; margin-bottom: 15px; }
        .quiz-type-btn {
            padding: 8px 16px; background: #e9ecef; border: none; border-radius: 20px;
            cursor: pointer; font-size: 13px; font-weight: bold; transition: all 0.3s;
        }
        .quiz-type-btn.active { background: #20c997; color: white; }
        .quiz-question { font-size: 36px; color: #333; margin: 20px 0 5px; font-weight: bold; }
        .quiz-hint { font-size: 18px; color: #868e96; margin-bottom: 15px; }
        .quiz-canvas-container {
            position: relative; background: #f8f9fa; border-radius: 15px;
            margin: 15px auto; border: 3px solid #e0e0e0; overflow: hidden; max-width: 350px;
        }
        #quizCanvas { display: block; width: 100%; height: 180px; cursor: crosshair; touch-action: none; }
        .quiz-guide-canvas { position: absolute; top: 0; left: 0; pointer-events: none; opacity: 0; transition: opacity 0.3s; }
        .quiz-guide-canvas.show { opacity: 0.3; }
        .quiz-controls-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 15px; }
        .quiz-controls-row button { padding: 12px 8px; font-size: 18px; }
        .btn-show-answer { background: #868e96; color: white; }
        .btn-show-answer:hover { background: #495057; }
        .btn-correct { background: #51cf66; color: white; }
        .btn-correct:hover { background: #40c057; }
        .btn-wrong { background: #ff6b6b; color: white; }
        .btn-wrong:hover { background: #fa5252; }
        .quiz-score { display: flex; justify-content: center; gap: 30px; margin-bottom: 15px; font-size: 16px; }
        .quiz-score .correct { color: #51cf66; }
        .quiz-score .wrong { color: #ff6b6b; }
        @media (max-width: 500px) {
            .modal-body { padding: 15px; }
            .char-main { font-size: 20px; }
            .char-romaji { font-size: 9px; }
            .hiragana-table th, .hiragana-table td { padding: 6px 3px; }
            .table-tab { padding: 8px 14px; font-size: 12px; }
            .quiz-question { font-size: 28px; }
        }
        @media (max-width: 400px) {
            .container { padding: 20px 15px; }
            h1 { font-size: 18px; }
            .current-character { font-size: 60px; }
            .character-info { font-size: 16px; }
            .category-selector { grid-template-columns: repeat(5, 1fr); gap: 6px; }
            .category-btn { padding: 8px 3px; font-size: 14px; }
            button { padding: 12px 8px; font-size: 14px; }
            .stroke-order { font-size: 13px; padding: 10px; }
            .shortcut-hint { display: none; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="back-button" onclick="goBack()">â†</button>
            <h1>ã‚ íˆë¼ê°€ë‚˜ ë”°ë¼ì“°ê¸°</h1>
            <div class="header-buttons">
                <div class="font-dropdown">
                    <button class="font-button" onclick="toggleFontDropdown()" title="í°íŠ¸ ë³€ê²½">Aa</button>
                    <div class="font-dropdown-content" id="fontDropdown">
                        <div class="font-option active" onclick="setFont('Noto Sans JP')" style="font-family: 'Noto Sans JP'">Noto Sans JP</div>
                        <div class="font-option" onclick="setFont('Zen Maru Gothic')" style="font-family: 'Zen Maru Gothic'">Zen Maru Gothic</div>
                        <div class="font-option" onclick="setFont('Kosugi Maru')" style="font-family: 'Kosugi Maru'">Kosugi Maru</div>
                        <div class="font-option" onclick="setFont('M PLUS Rounded 1c')" style="font-family: 'M PLUS Rounded 1c'">M PLUS Rounded</div>
                    </div>
                </div>
                <button class="quiz-button" onclick="openQuiz()" title="í€´ì¦ˆ ëª¨ë“œ">Q</button>
                <button class="chart-button" onclick="openChart()" title="íˆë¼ê°€ë‚˜ í‘œ ë³´ê¸°">è¡¨</button>
            </div>
        </div>
        <div class="level-selector">
            <button class="level-btn active" onclick="selectTab('basic')">ì²­ìŒÂ·íƒìŒÂ·ë°˜íƒìŒ</button>
            <button class="level-btn" onclick="selectTab('extended')">ìš”ìŒ (æ‹—éŸ³)</button>
        </div>
        <div class="category-selector" id="categorySelector"></div>
        <div class="progress" id="progressText">1 / 5</div>
        <div class="character-display">
            <div class="current-character jp-text" id="currentCharacter">ã‚<span class="check-mark" id="checkMark">âœ“</span></div>
            <div class="character-info" id="characterInfo">a (ì•„)</div>
        </div>
        <div class="canvas-container">
            <canvas id="drawingCanvas"></canvas>
            <canvas id="guideCanvas" class="guide-canvas"></canvas>
        </div>
        <div class="controls">
            <button class="btn-prev" onclick="prevCharacter()">â—€ ì´ì „</button>
            <button class="btn-next" onclick="nextCharacter()">ë‹¤ìŒ â–¶</button>
        </div>
        <div class="controls controls-three">
            <button class="btn-clear" onclick="clearCanvas()">ğŸ—‘ ì§€ìš°ê¸°</button>
            <button class="btn-show-guide" onclick="toggleGuide()">ğŸ‘ ê°€ì´ë“œ</button>
            <button class="btn-check" id="checkBtn" onclick="toggleCheck()">âœ“ ì™„ë£Œ</button>
        </div>
        <div class="stroke-order" id="strokeOrder">íšìˆœ: 3íš</div>
        <div class="shortcut-hint">ë‹¨ì¶•í‚¤: <kbd>â†</kbd> ì´ì „ <kbd>â†’</kbd> ë‹¤ìŒ <kbd>Space</kbd> ì§€ìš°ê¸° <kbd>Enter</kbd> ì™„ë£Œ</div>
    </div>

    <!-- íˆë¼ê°€ë‚˜ í‘œ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="chartModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ“‹ íˆë¼ê°€ë‚˜ í‘œ</h2>
                <button class="modal-close" onclick="closeChart()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="table-tabs">
                    <button class="table-tab active" onclick="switchTableTab('seion')">ì²­ìŒ Â· íƒìŒ Â· ë°˜íƒìŒ</button>
                    <button class="table-tab" onclick="switchTableTab('yoon')">ìš”ìŒ (æ‹—éŸ³)</button>
                </div>
                <div class="table-section active" id="seion-section">
                    <div class="section-title">âœ¨ ì²­ìŒ Â· íƒìŒ Â· ë°˜íƒìŒ</div>
                    <div class="table-scroll">
                        <table class="hiragana-table combined-table">
                            <thead><tr>
                                <th></th><th>ã‚</th><th>ã‹</th><th class="dakuon-header">ãŒ</th>
                                <th>ã•</th><th class="dakuon-header">ã–</th><th>ãŸ</th><th class="dakuon-header">ã </th>
                                <th>ãª</th><th>ã¯</th><th class="dakuon-header">ã°</th><th class="handakuon-header">ã±</th>
                                <th>ã¾</th><th>ã‚„</th><th>ã‚‰</th><th>ã‚</th>
                            </tr></thead>
                            <tbody>
                                <tr><td class="row-header">ã‚ë‹¨</td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã‚</span><span class="char-romaji">a/ì•„</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã‹</span><span class="char-romaji">ka/ì¹´</span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">ãŒ</span><span class="char-romaji">ga/ê°€</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã•</span><span class="char-romaji">sa/ì‚¬</span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">ã–</span><span class="char-romaji">za/ì</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ãŸ</span><span class="char-romaji">ta/íƒ€</span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">ã </span><span class="char-romaji">da/ë‹¤</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ãª</span><span class="char-romaji">na/ë‚˜</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã¯</span><span class="char-romaji">ha/í•˜</span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">ã°</span><span class="char-romaji">ba/ë°”</span></div></td>
                                    <td class="handakuon-cell"><div class="char-cell"><span class="char-main jp-text">ã±</span><span class="char-romaji">pa/íŒŒ</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã¾</span><span class="char-romaji">ma/ë§ˆ</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã‚„</span><span class="char-romaji">ya/ì•¼</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã‚‰</span><span class="char-romaji">ra/ë¼</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã‚</span><span class="char-romaji">wa/ì™€</span></div></td>
                                </tr>
                                <tr><td class="row-header">ã„ë‹¨</td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã„</span><span class="char-romaji">i/ì´</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã</span><span class="char-romaji">ki/í‚¤</span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">ã</span><span class="char-romaji">gi/ê¸°</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã—</span><span class="char-romaji">shi/ì‹œ</span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">ã˜</span><span class="char-romaji">ji/ì§€</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã¡</span><span class="char-romaji">chi/ì¹˜</span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">ã¢</span><span class="char-romaji">ji/ì§€</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã«</span><span class="char-romaji">ni/ë‹ˆ</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã²</span><span class="char-romaji">hi/íˆ</span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">ã³</span><span class="char-romaji">bi/ë¹„</span></div></td>
                                    <td class="handakuon-cell"><div class="char-cell"><span class="char-main jp-text">ã´</span><span class="char-romaji">pi/í”¼</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã¿</span><span class="char-romaji">mi/ë¯¸</span></div></td>
                                    <td class="empty-cell">-</td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã‚Š</span><span class="char-romaji">ri/ë¦¬</span></div></td>
                                    <td class="empty-cell">-</td>
                                </tr>
                                <tr><td class="row-header">ã†ë‹¨</td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã†</span><span class="char-romaji">u/ìš°</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã</span><span class="char-romaji">ku/ì¿ </span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">ã</span><span class="char-romaji">gu/êµ¬</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã™</span><span class="char-romaji">su/ìŠ¤</span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">ãš</span><span class="char-romaji">zu/ì¦ˆ</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã¤</span><span class="char-romaji">tsu/ì¸ </span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">ã¥</span><span class="char-romaji">zu/ì¦ˆ</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã¬</span><span class="char-romaji">nu/ëˆ„</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ãµ</span><span class="char-romaji">fu/í›„</span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">ã¶</span><span class="char-romaji">bu/ë¶€</span></div></td>
                                    <td class="handakuon-cell"><div class="char-cell"><span class="char-main jp-text">ã·</span><span class="char-romaji">pu/í‘¸</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã‚€</span><span class="char-romaji">mu/ë¬´</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã‚†</span><span class="char-romaji">yu/ìœ </span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã‚‹</span><span class="char-romaji">ru/ë£¨</span></div></td>
                                    <td class="empty-cell">-</td>
                                </tr>
                                <tr><td class="row-header">ãˆë‹¨</td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ãˆ</span><span class="char-romaji">e/ì—</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã‘</span><span class="char-romaji">ke/ì¼€</span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">ã’</span><span class="char-romaji">ge/ê²Œ</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã›</span><span class="char-romaji">se/ì„¸</span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">ãœ</span><span class="char-romaji">ze/ì œ</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã¦</span><span class="char-romaji">te/í…Œ</span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">ã§</span><span class="char-romaji">de/ë°</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã­</span><span class="char-romaji">ne/ë„¤</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã¸</span><span class="char-romaji">he/í—¤</span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">ã¹</span><span class="char-romaji">be/ë² </span></div></td>
                                    <td class="handakuon-cell"><div class="char-cell"><span class="char-main jp-text">ãº</span><span class="char-romaji">pe/í˜</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã‚</span><span class="char-romaji">me/ë©”</span></div></td>
                                    <td class="empty-cell">-</td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã‚Œ</span><span class="char-romaji">re/ë ˆ</span></div></td>
                                    <td class="empty-cell">-</td>
                                </tr>
                                <tr><td class="row-header">ãŠë‹¨</td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ãŠ</span><span class="char-romaji">o/ì˜¤</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã“</span><span class="char-romaji">ko/ì½”</span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">ã”</span><span class="char-romaji">go/ê³ </span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã</span><span class="char-romaji">so/ì†Œ</span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">ã</span><span class="char-romaji">zo/ì¡°</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã¨</span><span class="char-romaji">to/í† </span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">ã©</span><span class="char-romaji">do/ë„</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã®</span><span class="char-romaji">no/ë…¸</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã»</span><span class="char-romaji">ho/í˜¸</span></div></td>
                                    <td class="dakuon-cell"><div class="char-cell"><span class="char-main jp-text">ã¼</span><span class="char-romaji">bo/ë³´</span></div></td>
                                    <td class="handakuon-cell"><div class="char-cell"><span class="char-main jp-text">ã½</span><span class="char-romaji">po/í¬</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã‚‚</span><span class="char-romaji">mo/ëª¨</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã‚ˆ</span><span class="char-romaji">yo/ìš”</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã‚</span><span class="char-romaji">ro/ë¡œ</span></div></td>
                                    <td><div class="char-cell"><span class="char-main jp-text">ã‚’</span><span class="char-romaji">wo/ì˜¤</span></div></td>
                                </tr>
                                <tr><td class="row-header">ã‚“</td><td colspan="15"><div class="char-cell"><span class="char-main jp-text">ã‚“</span><span class="char-romaji">n/ì‘</span></div></td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="legend">
                        <span class="legend-item"><span class="legend-box seion-box"></span> ì²­ìŒ</span>
                        <span class="legend-item"><span class="legend-box dakuon-box"></span> íƒìŒ</span>
                        <span class="legend-item"><span class="legend-box handakuon-box"></span> ë°˜íƒìŒ</span>
                    </div>
                </div>
                <div class="table-section" id="yoon-section">
                    <div class="section-title">ğŸµ ìš”ìŒ</div>
                    <table class="yoon-table">
                        <thead><tr><th></th><th>~ã‚ƒ</th><th>~ã‚…</th><th>~ã‚‡</th></tr></thead>
                        <tbody>
                            <tr><td class="row-header">ã</td><td><div class="char-cell"><span class="char-main jp-text">ãã‚ƒ</span><span class="char-romaji">kya/ìº¬</span></div></td><td><div class="char-cell"><span class="char-main jp-text">ãã‚…</span><span class="char-romaji">kyu/í</span></div></td><td><div class="char-cell"><span class="char-main jp-text">ãã‚‡</span><span class="char-romaji">kyo/ì¿„</span></div></td></tr>
                            <tr class="dakuon-row"><td class="row-header">ã</td><td><div class="char-cell"><span class="char-main jp-text">ãã‚ƒ</span><span class="char-romaji">gya/ê°¸</span></div></td><td><div class="char-cell"><span class="char-main jp-text">ãã‚…</span><span class="char-romaji">gyu/ê·œ</span></div></td><td><div class="char-cell"><span class="char-main jp-text">ãã‚‡</span><span class="char-romaji">gyo/êµ</span></div></td></tr>
                            <tr><td class="row-header">ã—</td><td><div class="char-cell"><span class="char-main jp-text">ã—ã‚ƒ</span><span class="char-romaji">sha/ìƒ¤</span></div></td><td><div class="char-cell"><span class="char-main jp-text">ã—ã‚…</span><span class="char-romaji">shu/ìŠˆ</span></div></td><td><div class="char-cell"><span class="char-main jp-text">ã—ã‚‡</span><span class="char-romaji">sho/ì‡¼</span></div></td></tr>
                            <tr class="dakuon-row"><td class="row-header">ã˜</td><td><div class="char-cell"><span class="char-main jp-text">ã˜ã‚ƒ</span><span class="char-romaji">ja/ìŸˆ</span></div></td><td><div class="char-cell"><span class="char-main jp-text">ã˜ã‚…</span><span class="char-romaji">ju/ì¥¬</span></div></td><td><div class="char-cell"><span class="char-main jp-text">ã˜ã‚‡</span><span class="char-romaji">jo/ì£ </span></div></td></tr>
                            <tr><td class="row-header">ã¡</td><td><div class="char-cell"><span class="char-main jp-text">ã¡ã‚ƒ</span><span class="char-romaji">cha/ì± </span></div></td><td><div class="char-cell"><span class="char-main jp-text">ã¡ã‚…</span><span class="char-romaji">chu/ì¸„</span></div></td><td><div class="char-cell"><span class="char-main jp-text">ã¡ã‚‡</span><span class="char-romaji">cho/ìµ¸</span></div></td></tr>
                            <tr><td class="row-header">ã«</td><td><div class="char-cell"><span class="char-main jp-text">ã«ã‚ƒ</span><span class="char-romaji">nya/ëƒ</span></div></td><td><div class="char-cell"><span class="char-main jp-text">ã«ã‚…</span><span class="char-romaji">nyu/ë‰´</span></div></td><td><div class="char-cell"><span class="char-main jp-text">ã«ã‚‡</span><span class="char-romaji">nyo/ë‡¨</span></div></td></tr>
                            <tr><td class="row-header">ã²</td><td><div class="char-cell"><span class="char-main jp-text">ã²ã‚ƒ</span><span class="char-romaji">hya/í–</span></div></td><td><div class="char-cell"><span class="char-main jp-text">ã²ã‚…</span><span class="char-romaji">hyu/íœ´</span></div></td><td><div class="char-cell"><span class="char-main jp-text">ã²ã‚‡</span><span class="char-romaji">hyo/íš¨</span></div></td></tr>
                            <tr class="dakuon-row"><td class="row-header">ã³</td><td><div class="char-cell"><span class="char-main jp-text">ã³ã‚ƒ</span><span class="char-romaji">bya/ë±Œ</span></div></td><td><div class="char-cell"><span class="char-main jp-text">ã³ã‚…</span><span class="char-romaji">byu/ë·°</span></div></td><td><div class="char-cell"><span class="char-main jp-text">ã³ã‚‡</span><span class="char-romaji">byo/ëµ¤</span></div></td></tr>
                            <tr class="handakuon-row"><td class="row-header">ã´</td><td><div class="char-cell"><span class="char-main jp-text">ã´ã‚ƒ</span><span class="char-romaji">pya/í„</span></div></td><td><div class="char-cell"><span class="char-main jp-text">ã´ã‚…</span><span class="char-romaji">pyu/í“¨</span></div></td><td><div class="char-cell"><span class="char-main jp-text">ã´ã‚‡</span><span class="char-romaji">pyo/í‘œ</span></div></td></tr>
                            <tr><td class="row-header">ã¿</td><td><div class="char-cell"><span class="char-main jp-text">ã¿ã‚ƒ</span><span class="char-romaji">mya/ë¨€</span></div></td><td><div class="char-cell"><span class="char-main jp-text">ã¿ã‚…</span><span class="char-romaji">myu/ë®¤</span></div></td><td><div class="char-cell"><span class="char-main jp-text">ã¿ã‚‡</span><span class="char-romaji">myo/ë¬˜</span></div></td></tr>
                            <tr><td class="row-header">ã‚Š</td><td><div class="char-cell"><span class="char-main jp-text">ã‚Šã‚ƒ</span><span class="char-romaji">rya/ë´</span></div></td><td><div class="char-cell"><span class="char-main jp-text">ã‚Šã‚…</span><span class="char-romaji">ryu/ë¥˜</span></div></td><td><div class="char-cell"><span class="char-main jp-text">ã‚Šã‚‡</span><span class="char-romaji">ryo/ë£Œ</span></div></td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- í€´ì¦ˆ ëª¨ë‹¬ -->
    <div class="modal-overlay quiz-modal" id="quizModal">
        <div class="modal-content" style="max-width: 450px;">
            <div class="modal-header">
                <h2>ğŸ¯ íˆë¼ê°€ë‚˜ í€´ì¦ˆ</h2>
                <button class="modal-close" onclick="closeQuiz()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="quiz-container">
                    <div class="quiz-type-selector">
                        <button class="quiz-type-btn active" onclick="setQuizType('char')">ê¸€ì í€´ì¦ˆ</button>
                        <button class="quiz-type-btn" onclick="setQuizType('word')">ë‹¨ì–´ í€´ì¦ˆ</button>
                    </div>
                    <div class="quiz-score">
                        <span class="correct">â­• <span id="correctCount">0</span></span>
                        <span class="wrong">âŒ <span id="wrongCount">0</span></span>
                    </div>
                    <div class="quiz-question" id="quizQuestion">a (ì•„)</div>
                    <div class="quiz-hint" id="quizHint"></div>
                    <div class="quiz-canvas-container">
                        <canvas id="quizCanvas"></canvas>
                        <canvas id="quizGuideCanvas" class="quiz-guide-canvas"></canvas>
                    </div>
                    <div class="quiz-controls-row">
                        <button class="btn-clear" onclick="clearQuizCanvas()">ğŸ—‘</button>
                        <button class="btn-show-answer" onclick="showAnswer()">ğŸ‘</button>
                        <button class="btn-correct" onclick="markCorrect()">â­•</button>
                        <button class="btn-wrong" onclick="markWrong()">âŒ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const basicData = {
            a: [{char:'ã‚',romaji:'a',korean:'ì•„',strokes:'3íš'},{char:'ã„',romaji:'i',korean:'ì´',strokes:'2íš'},{char:'ã†',romaji:'u',korean:'ìš°',strokes:'2íš'},{char:'ãˆ',romaji:'e',korean:'ì—',strokes:'2íš'},{char:'ãŠ',romaji:'o',korean:'ì˜¤',strokes:'3íš'}],
            ka: [{char:'ã‹',romaji:'ka',korean:'ì¹´',strokes:'3íš'},{char:'ãŒ',romaji:'ga',korean:'ê°€',strokes:'íƒì '},{char:'ã',romaji:'ki',korean:'í‚¤',strokes:'4íš'},{char:'ã',romaji:'gi',korean:'ê¸°',strokes:'íƒì '},{char:'ã',romaji:'ku',korean:'ì¿ ',strokes:'1íš'},{char:'ã',romaji:'gu',korean:'êµ¬',strokes:'íƒì '},{char:'ã‘',romaji:'ke',korean:'ì¼€',strokes:'3íš'},{char:'ã’',romaji:'ge',korean:'ê²Œ',strokes:'íƒì '},{char:'ã“',romaji:'ko',korean:'ì½”',strokes:'2íš'},{char:'ã”',romaji:'go',korean:'ê³ ',strokes:'íƒì '}],
            sa: [{char:'ã•',romaji:'sa',korean:'ì‚¬',strokes:'3íš'},{char:'ã–',romaji:'za',korean:'ì',strokes:'íƒì '},{char:'ã—',romaji:'shi',korean:'ì‹œ',strokes:'1íš'},{char:'ã˜',romaji:'ji',korean:'ì§€',strokes:'íƒì '},{char:'ã™',romaji:'su',korean:'ìŠ¤',strokes:'2íš'},{char:'ãš',romaji:'zu',korean:'ì¦ˆ',strokes:'íƒì '},{char:'ã›',romaji:'se',korean:'ì„¸',strokes:'3íš'},{char:'ãœ',romaji:'ze',korean:'ì œ',strokes:'íƒì '},{char:'ã',romaji:'so',korean:'ì†Œ',strokes:'1íš'},{char:'ã',romaji:'zo',korean:'ì¡°',strokes:'íƒì '}],
            ta: [{char:'ãŸ',romaji:'ta',korean:'íƒ€',strokes:'4íš'},{char:'ã ',romaji:'da',korean:'ë‹¤',strokes:'íƒì '},{char:'ã¡',romaji:'chi',korean:'ì¹˜',strokes:'2íš'},{char:'ã¢',romaji:'ji',korean:'ì§€',strokes:'íƒì '},{char:'ã¤',romaji:'tsu',korean:'ì¸ ',strokes:'1íš'},{char:'ã¥',romaji:'zu',korean:'ì¦ˆ',strokes:'íƒì '},{char:'ã¦',romaji:'te',korean:'í…Œ',strokes:'1íš'},{char:'ã§',romaji:'de',korean:'ë°',strokes:'íƒì '},{char:'ã¨',romaji:'to',korean:'í† ',strokes:'2íš'},{char:'ã©',romaji:'do',korean:'ë„',strokes:'íƒì '}],
            na: [{char:'ãª',romaji:'na',korean:'ë‚˜',strokes:'4íš'},{char:'ã«',romaji:'ni',korean:'ë‹ˆ',strokes:'3íš'},{char:'ã¬',romaji:'nu',korean:'ëˆ„',strokes:'2íš'},{char:'ã­',romaji:'ne',korean:'ë„¤',strokes:'2íš'},{char:'ã®',romaji:'no',korean:'ë…¸',strokes:'1íš'}],
            ha: [{char:'ã¯',romaji:'ha',korean:'í•˜',strokes:'3íš'},{char:'ã°',romaji:'ba',korean:'ë°”',strokes:'íƒì '},{char:'ã±',romaji:'pa',korean:'íŒŒ',strokes:'ë°˜íƒì '},{char:'ã²',romaji:'hi',korean:'íˆ',strokes:'1íš'},{char:'ã³',romaji:'bi',korean:'ë¹„',strokes:'íƒì '},{char:'ã´',romaji:'pi',korean:'í”¼',strokes:'ë°˜íƒì '},{char:'ãµ',romaji:'fu',korean:'í›„',strokes:'4íš'},{char:'ã¶',romaji:'bu',korean:'ë¶€',strokes:'íƒì '},{char:'ã·',romaji:'pu',korean:'í‘¸',strokes:'ë°˜íƒì '},{char:'ã¸',romaji:'he',korean:'í—¤',strokes:'1íš'},{char:'ã¹',romaji:'be',korean:'ë² ',strokes:'íƒì '},{char:'ãº',romaji:'pe',korean:'í˜',strokes:'ë°˜íƒì '},{char:'ã»',romaji:'ho',korean:'í˜¸',strokes:'4íš'},{char:'ã¼',romaji:'bo',korean:'ë³´',strokes:'íƒì '},{char:'ã½',romaji:'po',korean:'í¬',strokes:'ë°˜íƒì '}],
            ma: [{char:'ã¾',romaji:'ma',korean:'ë§ˆ',strokes:'3íš'},{char:'ã¿',romaji:'mi',korean:'ë¯¸',strokes:'2íš'},{char:'ã‚€',romaji:'mu',korean:'ë¬´',strokes:'3íš'},{char:'ã‚',romaji:'me',korean:'ë©”',strokes:'2íš'},{char:'ã‚‚',romaji:'mo',korean:'ëª¨',strokes:'3íš'}],
            ya: [{char:'ã‚„',romaji:'ya',korean:'ì•¼',strokes:'3íš'},{char:'ã‚†',romaji:'yu',korean:'ìœ ',strokes:'2íš'},{char:'ã‚ˆ',romaji:'yo',korean:'ìš”',strokes:'2íš'}],
            ra: [{char:'ã‚‰',romaji:'ra',korean:'ë¼',strokes:'2íš'},{char:'ã‚Š',romaji:'ri',korean:'ë¦¬',strokes:'2íš'},{char:'ã‚‹',romaji:'ru',korean:'ë£¨',strokes:'1íš'},{char:'ã‚Œ',romaji:'re',korean:'ë ˆ',strokes:'2íš'},{char:'ã‚',romaji:'ro',korean:'ë¡œ',strokes:'1íš'}],
            wa: [{char:'ã‚',romaji:'wa',korean:'ì™€',strokes:'2íš'},{char:'ã‚’',romaji:'wo',korean:'ì˜¤',strokes:'3íš'},{char:'ã‚“',romaji:'n',korean:'ì‘',strokes:'1íš'}]
        };
        const extendedData = {
            kya: [{char:'ãã‚ƒ',romaji:'kya',korean:'ìº¬',strokes:'ã+ã‚ƒ'},{char:'ãã‚…',romaji:'kyu',korean:'í',strokes:'ã+ã‚…'},{char:'ãã‚‡',romaji:'kyo',korean:'ì¿„',strokes:'ã+ã‚‡'},{char:'ãã‚ƒ',romaji:'gya',korean:'ê°¸',strokes:'ã+ã‚ƒ'},{char:'ãã‚…',romaji:'gyu',korean:'ê·œ',strokes:'ã+ã‚…'},{char:'ãã‚‡',romaji:'gyo',korean:'êµ',strokes:'ã+ã‚‡'}],
            sha: [{char:'ã—ã‚ƒ',romaji:'sha',korean:'ìƒ¤',strokes:'ã—+ã‚ƒ'},{char:'ã—ã‚…',romaji:'shu',korean:'ìŠˆ',strokes:'ã—+ã‚…'},{char:'ã—ã‚‡',romaji:'sho',korean:'ì‡¼',strokes:'ã—+ã‚‡'},{char:'ã˜ã‚ƒ',romaji:'ja',korean:'ìŸˆ',strokes:'ã˜+ã‚ƒ'},{char:'ã˜ã‚…',romaji:'ju',korean:'ì¥¬',strokes:'ã˜+ã‚…'},{char:'ã˜ã‚‡',romaji:'jo',korean:'ì£ ',strokes:'ã˜+ã‚‡'}],
            cha: [{char:'ã¡ã‚ƒ',romaji:'cha',korean:'ì± ',strokes:'ã¡+ã‚ƒ'},{char:'ã¡ã‚…',romaji:'chu',korean:'ì¸„',strokes:'ã¡+ã‚…'},{char:'ã¡ã‚‡',romaji:'cho',korean:'ìµ¸',strokes:'ã¡+ã‚‡'}],
            nya: [{char:'ã«ã‚ƒ',romaji:'nya',korean:'ëƒ',strokes:'ã«+ã‚ƒ'},{char:'ã«ã‚…',romaji:'nyu',korean:'ë‰´',strokes:'ã«+ã‚…'},{char:'ã«ã‚‡',romaji:'nyo',korean:'ë‡¨',strokes:'ã«+ã‚‡'}],
            hya: [{char:'ã²ã‚ƒ',romaji:'hya',korean:'í–',strokes:'ã²+ã‚ƒ'},{char:'ã²ã‚…',romaji:'hyu',korean:'íœ´',strokes:'ã²+ã‚…'},{char:'ã²ã‚‡',romaji:'hyo',korean:'íš¨',strokes:'ã²+ã‚‡'},{char:'ã³ã‚ƒ',romaji:'bya',korean:'ë±Œ',strokes:'ã³+ã‚ƒ'},{char:'ã³ã‚…',romaji:'byu',korean:'ë·°',strokes:'ã³+ã‚…'},{char:'ã³ã‚‡',romaji:'byo',korean:'ëµ¤',strokes:'ã³+ã‚‡'},{char:'ã´ã‚ƒ',romaji:'pya',korean:'í„',strokes:'ã´+ã‚ƒ'},{char:'ã´ã‚…',romaji:'pyu',korean:'í“¨',strokes:'ã´+ã‚…'},{char:'ã´ã‚‡',romaji:'pyo',korean:'í‘œ',strokes:'ã´+ã‚‡'}],
            mya: [{char:'ã¿ã‚ƒ',romaji:'mya',korean:'ë¨€',strokes:'ã¿+ã‚ƒ'},{char:'ã¿ã‚…',romaji:'myu',korean:'ë®¤',strokes:'ã¿+ã‚…'},{char:'ã¿ã‚‡',romaji:'myo',korean:'ë¬˜',strokes:'ã¿+ã‚‡'}],
            rya: [{char:'ã‚Šã‚ƒ',romaji:'rya',korean:'ë´',strokes:'ã‚Š+ã‚ƒ'},{char:'ã‚Šã‚…',romaji:'ryu',korean:'ë¥˜',strokes:'ã‚Š+ã‚…'},{char:'ã‚Šã‚‡',romaji:'ryo',korean:'ë£Œ',strokes:'ã‚Š+ã‚‡'}]
        };
        const wordData = [
            {word:'ã‚ã‚',romaji:'ame',korean:'ë¹„/ì‚¬íƒ•'},{word:'ã„ã¬',romaji:'inu',korean:'ê°œ'},{word:'ã†ã¿',romaji:'umi',korean:'ë°”ë‹¤'},
            {word:'ãˆã',romaji:'eki',korean:'ì—­'},{word:'ãŠã‹',romaji:'oka',korean:'ì–¸ë•'},{word:'ã‹ã•',romaji:'kasa',korean:'ìš°ì‚°'},
            {word:'ãã',romaji:'kiku',korean:'êµ­í™”'},{word:'ãã‚‚',romaji:'kumo',korean:'êµ¬ë¦„'},{word:'ã“ãˆ',romaji:'koe',korean:'ëª©ì†Œë¦¬'},
            {word:'ã•ãã‚‰',romaji:'sakura',korean:'ë²šê½ƒ'},{word:'ã—ã‚',romaji:'shiro',korean:'í°ìƒ‰'},{word:'ã™ã—',romaji:'sushi',korean:'ì´ˆë°¥'},
            {word:'ã›ã‹ã„',romaji:'sekai',korean:'ì„¸ê³„'},{word:'ãã‚‰',romaji:'sora',korean:'í•˜ëŠ˜'},{word:'ãŸã¹ã‚‹',romaji:'taberu',korean:'ë¨¹ë‹¤'},
            {word:'ã¡ãš',romaji:'chizu',korean:'ì§€ë„'},{word:'ã¤ã',romaji:'tsuki',korean:'ë‹¬'},{word:'ã¦ãŒã¿',romaji:'tegami',korean:'í¸ì§€'},
            {word:'ã¨ã‚‚ã ã¡',romaji:'tomodachi',korean:'ì¹œêµ¬'},{word:'ãªã¤',romaji:'natsu',korean:'ì—¬ë¦„'},{word:'ã«ã',romaji:'niku',korean:'ê³ ê¸°'},
            {word:'ã­ã“',romaji:'neko',korean:'ê³ ì–‘ì´'},{word:'ã®ã¿ã‚‚ã®',romaji:'nomimono',korean:'ìŒë£Œ'},{word:'ã¯ãª',romaji:'hana',korean:'ê½ƒ'},
            {word:'ã²ã¨',romaji:'hito',korean:'ì‚¬ëŒ'},{word:'ãµã­',romaji:'fune',korean:'ë°°'},{word:'ã¸ã‚„',romaji:'heya',korean:'ë°©'},
            {word:'ã»ã—',romaji:'hoshi',korean:'ë³„'},{word:'ã¾ã¡',romaji:'machi',korean:'ë§ˆì„'},{word:'ã¿ãš',romaji:'mizu',korean:'ë¬¼'},
            {word:'ã‚€ã—',romaji:'mushi',korean:'ë²Œë ˆ'},{word:'ã‚ãŒã­',romaji:'megane',korean:'ì•ˆê²½'},{word:'ã‚‚ã‚Š',romaji:'mori',korean:'ìˆ²'},
            {word:'ã‚„ã¾',romaji:'yama',korean:'ì‚°'},{word:'ã‚†ã',romaji:'yuki',korean:'ëˆˆ'},{word:'ã‚ˆã‚‹',romaji:'yoru',korean:'ë°¤'},
            {word:'ã‚Šã‚“ã”',romaji:'ringo',korean:'ì‚¬ê³¼'},{word:'ã‚ãŸã—',romaji:'watashi',korean:'ë‚˜'},{word:'ãŠã‚“ãŒã',romaji:'ongaku',korean:'ìŒì•…'}
        ];
        const basicCategories = ['a','ka','sa','ta','na','ha','ma','ya','ra','wa'];
        const extendedCategories = ['kya','sha','cha','nya','hya','mya','rya'];
        const categoryLabels = {a:'ã‚',ka:'ã‹',sa:'ã•',ta:'ãŸ',na:'ãª',ha:'ã¯',ma:'ã¾',ya:'ã‚„',ra:'ã‚‰',wa:'ã‚',kya:'ãã‚ƒ',sha:'ã—ã‚ƒ',cha:'ã¡ã‚ƒ',nya:'ã«ã‚ƒ',hya:'ã²ã‚ƒ',mya:'ã¿ã‚ƒ',rya:'ã‚Šã‚ƒ'};
        
        let currentTab='basic',currentCategory='a',currentIndex=0,isDrawing=false,showGuide=true,currentFont='Noto Sans JP';
        let checkedChars=JSON.parse(localStorage.getItem('hiraganaCheckedChars')||'{}');
        const canvas=document.getElementById('drawingCanvas'),guideCanvas=document.getElementById('guideCanvas');
        const ctx=canvas.getContext('2d'),guideCtx=guideCanvas.getContext('2d');
        
        function getCurrentData(){return currentTab==='basic'?basicData:extendedData;}
        function getCurrentChar(){return getCurrentData()[currentCategory][currentIndex];}
        function toggleFontDropdown(){document.getElementById('fontDropdown').classList.toggle('show');}
        function setFont(f){currentFont=f;document.documentElement.style.setProperty('--jp-font',`'${f}',sans-serif`);document.querySelectorAll('.font-option').forEach(o=>o.classList.remove('active'));event.target.classList.add('active');document.getElementById('fontDropdown').classList.remove('show');localStorage.setItem('hiraganaFont',f);drawGuideCharacter();}
        document.addEventListener('click',e=>{if(!e.target.closest('.font-dropdown'))document.getElementById('fontDropdown').classList.remove('show');});
        
        function initCanvas(){const r=canvas.parentElement.getBoundingClientRect();canvas.width=guideCanvas.width=r.width;canvas.height=guideCanvas.height=250;ctx.lineWidth=3;ctx.lineCap=ctx.lineJoin='round';ctx.strokeStyle='#667eea';drawGuideCharacter();}
        function drawGuideCharacter(){const c=getCurrentChar();guideCtx.clearRect(0,0,guideCanvas.width,guideCanvas.height);const fs=c.char.length===1?guideCanvas.height*0.8:guideCanvas.height*0.5;guideCtx.font=`bold ${fs}px '${currentFont}',sans-serif`;guideCtx.fillStyle='#764ba2';guideCtx.textAlign='center';guideCtx.textBaseline='middle';guideCtx.fillText(c.char,guideCanvas.width/2,guideCanvas.height/2);}
        function getPos(e){const r=canvas.getBoundingClientRect(),t=e.touches?e.touches[0]:e;return{x:t.clientX-r.left,y:t.clientY-r.top};}
        function startDrawing(e){e.preventDefault();isDrawing=true;const p=getPos(e);ctx.beginPath();ctx.moveTo(p.x,p.y);}
        function draw(e){if(!isDrawing)return;e.preventDefault();const p=getPos(e);ctx.lineTo(p.x,p.y);ctx.stroke();}
        function stopDrawing(){isDrawing=false;}
        function clearCanvas(){ctx.clearRect(0,0,canvas.width,canvas.height);}
        function toggleGuide(){showGuide=!showGuide;guideCanvas.style.opacity=showGuide?'0.3':'0';}
        function toggleCheck(){const k=getCurrentChar().char;checkedChars[k]?delete checkedChars[k]:checkedChars[k]=true;localStorage.setItem('hiraganaCheckedChars',JSON.stringify(checkedChars));updateCheckDisplay();updateCategoryButtons();}
        function updateCheckDisplay(){const k=getCurrentChar().char,c=checkedChars[k],m=document.getElementById('checkMark'),b=document.getElementById('checkBtn');if(c){m.classList.add('show');b.classList.add('checked');b.textContent='âœ“ ì™„ë£Œë¨';}else{m.classList.remove('show');b.classList.remove('checked');b.textContent='âœ“ ì™„ë£Œ';}}
        function nextCharacter(){const d=getCurrentData();currentIndex=(currentIndex+1)%d[currentCategory].length;updateDisplay();clearCanvas();drawGuideCharacter();}
        function prevCharacter(){const d=getCurrentData();currentIndex=(currentIndex-1+d[currentCategory].length)%d[currentCategory].length;updateDisplay();clearCanvas();drawGuideCharacter();}
        function selectCategory(c){currentCategory=c;currentIndex=0;document.querySelectorAll('.category-btn').forEach(b=>b.classList.remove('active'));event.target.closest('.category-btn').classList.add('active');updateDisplay();clearCanvas();drawGuideCharacter();}
        function selectTab(t){currentTab=t;document.querySelectorAll('.level-btn').forEach(b=>b.classList.remove('active'));event.target.classList.add('active');updateCategoryButtons();currentCategory=(currentTab==='basic'?basicCategories:extendedCategories)[0];currentIndex=0;updateDisplay();clearCanvas();drawGuideCharacter();}
        function updateCategoryButtons(){const s=document.getElementById('categorySelector'),cats=currentTab==='basic'?basicCategories:extendedCategories,d=getCurrentData();s.innerHTML='';cats.forEach(c=>{const b=document.createElement('button');b.className='category-btn jp-text'+(c===currentCategory?' active':'');const cd=d[c];let cnt=0;cd.forEach(i=>{if(checkedChars[i.char])cnt++;});b.innerHTML=`${categoryLabels[c]}<span class="cat-progress">${cnt>0?cnt+'/'+cd.length:''}</span>`;b.onclick=function(){selectCategory(c);};s.appendChild(b);});}
        function updateDisplay(){const c=getCurrentChar(),d=getCurrentData();document.getElementById('currentCharacter').innerHTML=`${c.char}<span class="check-mark" id="checkMark">âœ“</span>`;document.getElementById('characterInfo').textContent=`${c.romaji} (${c.korean})`;document.getElementById('strokeOrder').textContent=`íšìˆœ: ${c.strokes}`;document.getElementById('progressText').textContent=`${currentIndex+1} / ${d[currentCategory].length}`;updateCheckDisplay();}
        function openChart(){document.getElementById('chartModal').classList.add('show');document.body.style.overflow='hidden';}
        function closeChart(){document.getElementById('chartModal').classList.remove('show');document.body.style.overflow='';}
        function switchTableTab(n){document.querySelectorAll('.table-tab').forEach(b=>b.classList.remove('active'));event.target.classList.add('active');document.querySelectorAll('.table-section').forEach(s=>s.classList.remove('active'));document.getElementById(n+'-section').classList.add('active');}
        
        let quizType='char',quizCorrect=0,quizWrong=0,currentQuizItem=null,quizCanvas,quizCtx,quizGuideCanvas,quizGuideCtx,isQuizDrawing=false;
        function openQuiz(){document.getElementById('quizModal').classList.add('show');document.body.style.overflow='hidden';initQuizCanvas();nextQuizQuestion();}
        function closeQuiz(){document.getElementById('quizModal').classList.remove('show');document.body.style.overflow='';}
        function setQuizType(t){quizType=t;quizCorrect=quizWrong=0;document.getElementById('correctCount').textContent='0';document.getElementById('wrongCount').textContent='0';document.querySelectorAll('.quiz-type-btn').forEach(b=>b.classList.remove('active'));event.target.classList.add('active');nextQuizQuestion();}
        function initQuizCanvas(){quizCanvas=document.getElementById('quizCanvas');quizCtx=quizCanvas.getContext('2d');quizGuideCanvas=document.getElementById('quizGuideCanvas');quizGuideCtx=quizGuideCanvas.getContext('2d');const r=quizCanvas.parentElement.getBoundingClientRect();quizCanvas.width=quizGuideCanvas.width=r.width;quizCanvas.height=quizGuideCanvas.height=180;quizCtx.lineWidth=3;quizCtx.lineCap=quizCtx.lineJoin='round';quizCtx.strokeStyle='#20c997';quizCanvas.onmousedown=startQuizDrawing;quizCanvas.onmousemove=quizDraw;quizCanvas.onmouseup=quizCanvas.onmouseout=stopQuizDrawing;quizCanvas.ontouchstart=startQuizDrawing;quizCanvas.ontouchmove=quizDraw;quizCanvas.ontouchend=stopQuizDrawing;}
        function getQuizPos(e){const r=quizCanvas.getBoundingClientRect(),t=e.touches?e.touches[0]:e;return{x:t.clientX-r.left,y:t.clientY-r.top};}
        function startQuizDrawing(e){e.preventDefault();isQuizDrawing=true;const p=getQuizPos(e);quizCtx.beginPath();quizCtx.moveTo(p.x,p.y);}
        function quizDraw(e){if(!isQuizDrawing)return;e.preventDefault();const p=getQuizPos(e);quizCtx.lineTo(p.x,p.y);quizCtx.stroke();}
        function stopQuizDrawing(){isQuizDrawing=false;}
        function clearQuizCanvas(){quizCtx.clearRect(0,0,quizCanvas.width,quizCanvas.height);}
        function getAllChars(){let a=[];basicCategories.forEach(c=>a=a.concat(basicData[c]));return a;}
        function nextQuizQuestion(){if(quizType==='char'){const a=getAllChars();currentQuizItem=a[Math.floor(Math.random()*a.length)];document.getElementById('quizQuestion').textContent=`${currentQuizItem.romaji} (${currentQuizItem.korean})`;document.getElementById('quizHint').textContent='';}else{currentQuizItem=wordData[Math.floor(Math.random()*wordData.length)];document.getElementById('quizQuestion').textContent=currentQuizItem.korean;document.getElementById('quizHint').textContent=`(${currentQuizItem.romaji})`;}quizGuideCanvas.classList.remove('show');clearQuizCanvas();drawQuizGuide();}
        function drawQuizGuide(){quizGuideCtx.clearRect(0,0,quizGuideCanvas.width,quizGuideCanvas.height);const ans=quizType==='char'?currentQuizItem.char:currentQuizItem.word;const fs=ans.length<=2?quizGuideCanvas.height*0.6:Math.min(quizGuideCanvas.width/ans.length*1.5,quizGuideCanvas.height*0.5);quizGuideCtx.font=`bold ${fs}px '${currentFont}',sans-serif`;quizGuideCtx.fillStyle='#20c997';quizGuideCtx.textAlign='center';quizGuideCtx.textBaseline='middle';quizGuideCtx.fillText(ans,quizGuideCanvas.width/2,quizGuideCanvas.height/2);}
        function showAnswer(){quizGuideCanvas.classList.add('show');}
        function markCorrect(){quizCorrect++;document.getElementById('correctCount').textContent=quizCorrect;nextQuizQuestion();}
        function markWrong(){quizWrong++;document.getElementById('wrongCount').textContent=quizWrong;nextQuizQuestion();}
        
        document.addEventListener('keydown',e=>{const c=document.getElementById('chartModal').classList.contains('show'),q=document.getElementById('quizModal').classList.contains('show');if(e.key==='Escape'){closeChart();closeQuiz();return;}if(c||q)return;switch(e.key){case'ArrowLeft':e.preventDefault();prevCharacter();break;case'ArrowRight':e.preventDefault();nextCharacter();break;case' ':e.preventDefault();clearCanvas();break;case'Enter':e.preventDefault();toggleCheck();break;case'g':case'G':toggleGuide();break;}});
        document.getElementById('chartModal').addEventListener('click',e=>{if(e.target===document.getElementById('chartModal'))closeChart();});
        document.getElementById('quizModal').addEventListener('click',e=>{if(e.target===document.getElementById('quizModal'))closeQuiz();});
        canvas.addEventListener('mousedown',startDrawing);canvas.addEventListener('mousemove',draw);canvas.addEventListener('mouseup',stopDrawing);canvas.addEventListener('mouseout',stopDrawing);
        canvas.addEventListener('touchstart',startDrawing);canvas.addEventListener('touchmove',draw);canvas.addEventListener('touchend',stopDrawing);
        window.addEventListener('resize',initCanvas);
        function goBack(){window.location.href='index.html';}
        const sf=localStorage.getItem('hiraganaFont');if(sf){currentFont=sf;document.documentElement.style.setProperty('--jp-font',`'${sf}',sans-serif`);document.querySelectorAll('.font-option').forEach(o=>o.classList.toggle('active',o.textContent.trim()===sf));}
        updateCategoryButtons();initCanvas();updateDisplay();
    </script>
</body>
</html>
